<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Hoare3: Hoare Logic, Part II (Second Half</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/plf.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 2: Programming Language Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Hoare3<span class="subtitle">Hoare Logic, Part II (Second Half</span></h1>



<div class="doc">
<a id="lab124"></a><h1 class="section">Formal Decorated Programs</h1>

<div class="paragraph"> </div>

 With a little more work, we can formalize the definition of
    well-formed decorated programs and automate the boring, mechanical
    steps when filling in decorations. 
<div class="paragraph"> </div>

<a id="lab125"></a><h2 class="section">Syntax</h2>

<div class="paragraph"> </div>

 <i>Decorated commands</i> contain assertions mostly just as
    postconditions, omitting preconditions where possible and letting
    the context supply them.

<div class="paragraph"> </div>

    Why?  Because the alternative--decorating every command with both
    a pre- and postcondition--would be too heavyweight.

<div class="paragraph"> </div>

    E.g., <span class="inlinecode"><span class="id" title="var">skip</span>;</span> <span class="inlinecode"><span class="id" title="var">skip</span></span> would become:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P</span><span style='letter-spacing:-.4em;'>}</span>} (<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P</span><span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">skip</span> <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P</span><span style='letter-spacing:-.4em;'>}</span>}) ; (<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P</span><span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">skip</span> <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P</span><span style='letter-spacing:-.4em;'>}</span>}) <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P</span><span style='letter-spacing:-.4em;'>}</span>},
</span>
<div class="paragraph"> </div>

 Concretely, we decorate programs as follows... 
<div class="paragraph"> </div>

<a id="lab126"></a><h3 class="section"> </h3>
<ul class="doclist">
<li> The <span class="inlinecode"><span class="id" title="var">skip</span></span> command is decorated only with its postcondition
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">skip</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Q</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>      on the assumption that the precondition will be provided by the
      context.

<div class="paragraph"> </div>

      We carry the same assumption through the other syntactic forms:
      each decorated command is assumed to carry its own postcondition
      within itself but take its precondition from its context in
      which it is used.

</li>
</ul>

<div class="paragraph"> </div>

<a id="lab127"></a><h3 class="section"> </h3>
<ul class="doclist">
<li> Sequences <span class="inlinecode"><span class="id" title="var">d<sub>1</sub></span></span> <span class="inlinecode">;</span> <span class="inlinecode"><span class="id" title="var">d<sub>2</sub></span></span> need no additional decorations.

<div class="paragraph"> </div>

      Why?  Inside <span class="inlinecode"><span class="id" title="var">d<sub>2</sub></span></span> there will be a postcondition; this serves as
      the postcondition of <span class="inlinecode"><span class="id" title="var">d<sub>1</sub></span>;<span class="id" title="var">d<sub>2</sub></span></span>.  Inside <span class="inlinecode"><span class="id" title="var">d<sub>1</sub></span></span> there will also be
      a postcondition, which additionally serves as the precondition
      for <span class="inlinecode"><span class="id" title="var">d<sub>2</sub></span></span>. 
</li>
</ul>

<div class="paragraph"> </div>

<a id="lab128"></a><h3 class="section"> </h3>
<ul class="doclist">
<li> An assignment <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">a</span></span> is decorated only with its postcondition:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">a</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Q</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>
</li>
</ul>

<div class="paragraph"> </div>

<a id="lab129"></a><h3 class="section"> </h3>
<ul class="doclist">
<li> A conditional <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode"><span class="id" title="var">d<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode"><span class="id" title="var">d<sub>2</sub></span></span> is decorated with a
      postcondition for the entire statement, as well as preconditions
      for each branch:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">P<sub>1</sub></span> <span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">d<sub>1</sub></span> <span class="id" title="keyword">else</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">P<sub>2</sub></span> <span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">d<sub>2</sub></span> <span class="id" title="keyword">end</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Q</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>
</li>
</ul>

<div class="paragraph"> </div>

<a id="lab130"></a><h3 class="section"> </h3>
<ul class="doclist">
<li> A loop <span class="inlinecode"><span class="id" title="var">while</span></span> <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode"><span class="id" title="tactic">do</span></span> <span class="inlinecode"><span class="id" title="var">d</span></span> <span class="inlinecode"><span class="id" title="keyword">end</span></span> is decorated with its postcondition
      and a precondition for the body:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">P</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">d</span> <span class="id" title="keyword">end</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Q</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>      The postcondition embedded in <span class="inlinecode"><span class="id" title="var">d</span></span> serves as the loop invariant. 
</li>
</ul>

<div class="paragraph"> </div>

<a id="lab131"></a><h3 class="section"> </h3>
<ul class="doclist">
<li> Implications <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> can be added as decorations either for a
      precondition
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">P</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">d</span>
</span>      or for a postcondition
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">d</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Q</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>      The former is waiting for another precondition to eventually be
      supplied (e.g., <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{</span> <span class="inlinecode"><span class="id" title="var">P'</span><span style='letter-spacing:-.4em;'>}</span>}</span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{</span> <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>}</span>}</span> <span class="inlinecode"><span class="id" title="var">d</span></span>); the latter relies on
      the postcondition already embedded in <span class="inlinecode"><span class="id" title="var">d</span></span>. 
</li>
</ul>

<div class="paragraph"> </div>

<a id="lab132"></a><h3 class="section"> </h3>
 Here's the formal syntax of decorated commands: 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">dcom</span> : <span class="id" title="keyword">Type</span> :=<br/>
| <span class="id" title="var">DCSkip</span> (<span class="id" title="var">Q</span> : <span class="id" title="var">Assertion</span>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;skip&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;Q&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;*)</span><br/>
| <span class="id" title="var">DCSeq</span> (<span class="id" title="var">d<sub>1</sub></span> <span class="id" title="var">d<sub>2</sub></span> : <span class="id" title="var">dcom</span>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;d<sub>1</sub>&nbsp;;&nbsp;d<sub>2</sub>&nbsp;*)</span><br/>
| <span class="id" title="var">DCAsgn</span> (<span class="id" title="var">X</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">aexp</span>) (<span class="id" title="var">Q</span> : <span class="id" title="var">Assertion</span>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;X&nbsp;:=&nbsp;a&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;Q&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;*)</span><br/>
| <span class="id" title="var">DCIf</span> (<span class="id" title="var">b</span> : <span class="id" title="var">bexp</span>) (<span class="id" title="var">P<sub>1</sub></span> : <span class="id" title="var">Assertion</span>) (<span class="id" title="var">d<sub>1</sub></span> : <span class="id" title="var">dcom</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P<sub>2</sub></span> : <span class="id" title="var">Assertion</span>) (<span class="id" title="var">d<sub>2</sub></span> : <span class="id" title="var">dcom</span>) (<span class="id" title="var">Q</span> : <span class="id" title="var">Assertion</span>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;if&nbsp;b&nbsp;then&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;P<sub>1</sub>&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;d<sub>1</sub>&nbsp;else&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;P<sub>2</sub>&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;d<sub>2</sub>&nbsp;end&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;Q&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;*)</span><br/>
| <span class="id" title="var">DCWhile</span> (<span class="id" title="var">b</span> : <span class="id" title="var">bexp</span>) (<span class="id" title="var">P</span> : <span class="id" title="var">Assertion</span>) (<span class="id" title="var">d</span> : <span class="id" title="var">dcom</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Q</span> : <span class="id" title="var">Assertion</span>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;while&nbsp;b&nbsp;do&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;P&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;d&nbsp;end&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;Q&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;*)</span><br/>
| <span class="id" title="var">DCPre</span> (<span class="id" title="var">P</span> : <span class="id" title="var">Assertion</span>) (<span class="id" title="var">d</span> : <span class="id" title="var">dcom</span>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;P&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;d&nbsp;*)</span><br/>
| <span class="id" title="var">DCPost</span> (<span class="id" title="var">d</span> : <span class="id" title="var">dcom</span>) (<span class="id" title="var">Q</span> : <span class="id" title="var">Assertion</span>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;d&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;Q&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;*)</span>.<br/>
</div>

<div class="doc">
<a id="lab133"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 To provide the initial precondition that goes at the very top of a
    decorated program, we introduce a new type <span class="inlinecode"><span class="id" title="var">decorated</span></span>: 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">decorated</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">Decorated</span> : <span class="id" title="var">Assertion</span> → <span class="id" title="var">dcom</span> → <span class="id" title="var">decorated</span>.<br/>
</div>

<div class="doc">
<a id="lab134"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 To avoid clashing with the existing <span class="inlinecode"><span class="id" title="keyword">Notation</span></span>s for ordinary
    <span class="inlinecode"><span class="id" title="var">com</span></span>mands, we introduce these notations in a new grammar scope
    called <span class="inlinecode"><span class="id" title="var">dcom</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Declare Scope</span> <span class="id" title="var">dcom_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;'skip' <span style='letter-spacing:-.4em;'>{</span>{ P <span style='letter-spacing:-.4em;'>}</span>}"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" title="var">DCSkip</span> <span class="id" title="var">P</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">P</span> <span class="id" title="keyword">constr</span>) : <span class="id" title="var">dcom_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;l ':=' a <span style='letter-spacing:-.4em;'>{</span>{ P <span style='letter-spacing:-.4em;'>}</span>}"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" title="var">DCAsgn</span> <span class="id" title="var">l</span> <span class="id" title="var">a</span> <span class="id" title="var">P</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">l</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 85, <span class="id" title="var">P</span> <span class="id" title="keyword">constr</span>, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>) : <span class="id" title="var">dcom_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;'while' b 'do' <span style='letter-spacing:-.4em;'>{</span>{ Pbody <span style='letter-spacing:-.4em;'>}</span>} d 'end' <span style='letter-spacing:-.4em;'>{</span>{ Ppost <span style='letter-spacing:-.4em;'>}</span>}"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" title="var">DCWhile</span> <span class="id" title="var">b</span> <span class="id" title="var">Pbody</span> <span class="id" title="var">d</span> <span class="id" title="var">Ppost</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 89, <span class="id" title="var">b</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Pbody</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">Ppost</span> <span class="id" title="keyword">constr</span>) : <span class="id" title="var">dcom_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;'if' b 'then' <span style='letter-spacing:-.4em;'>{</span>{ P <span style='letter-spacing:-.4em;'>}</span>} d 'else' <span style='letter-spacing:-.4em;'>{</span>{ P' <span style='letter-spacing:-.4em;'>}</span>} d' 'end' <span style='letter-spacing:-.4em;'>{</span>{ Q <span style='letter-spacing:-.4em;'>}</span>}"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" title="var">DCIf</span> <span class="id" title="var">b</span> <span class="id" title="var">P</span> <span class="id" title="var">d</span> <span class="id" title="var">P'</span> <span class="id" title="var">d'</span> <span class="id" title="var">Q</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 89, <span class="id" title="var">b</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">P'</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">Q</span> <span class="id" title="keyword">constr</span>) : <span class="id" title="var">dcom_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;'<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>' <span style='letter-spacing:-.4em;'>{</span>{ P <span style='letter-spacing:-.4em;'>}</span>} d"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" title="var">DCPre</span> <span class="id" title="var">P</span> <span class="id" title="var">d</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 12, <span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>, <span class="id" title="var">P</span> <span class="id" title="keyword">constr</span>) : <span class="id" title="var">dcom_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;d '<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>' <span style='letter-spacing:-.4em;'>{</span>{ P <span style='letter-spacing:-.4em;'>}</span>}"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" title="var">DCPost</span> <span class="id" title="var">d</span> <span class="id" title="var">P</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 10, <span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>, <span class="id" title="var">P</span> <span class="id" title="keyword">constr</span>) : <span class="id" title="var">dcom_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot; d ; d' "<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" title="var">DCSeq</span> <span class="id" title="var">d</span> <span class="id" title="var">d'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 90, <span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>) : <span class="id" title="var">dcom_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;<span style='letter-spacing:-.4em;'>{</span>{ P <span style='letter-spacing:-.4em;'>}</span>} d"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" title="var">Decorated</span> <span class="id" title="var">P</span> <span class="id" title="var">d</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 91, <span class="id" title="var">P</span> <span class="id" title="keyword">constr</span>) : <span class="id" title="var">dcom_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">dcom_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">dec0</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">skip</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> <span style='letter-spacing:-.4em;'>}</span>} }&gt;.<br/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">dec1</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">while</span> <span class="id" title="var">true</span> <span class="id" title="tactic">do</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">skip</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> <span style='letter-spacing:-.4em;'>}</span>} }&gt;.<br/>
</div>

<div class="doc">
Recall that you can <span class="inlinecode"><span class="id" title="keyword">Set</span></span> <span class="inlinecode"><span class="id" title="keyword">Printing</span></span> <span class="inlinecode"><span class="id" title="keyword">All</span></span> to see how all that
    notation is desugared. 
</div>
<div class="code">
<span class="id" title="keyword">Set Printing All</span>.<br/>
<span class="id" title="keyword">Print</span> <span class="id" title="var">dec1</span>.<br/>
<span class="id" title="keyword">Unset Printing All</span>.<br/>
</div>

<div class="doc">
An example <span class="inlinecode"><span class="id" title="var">decorated</span></span> program that decrements <span class="inlinecode"><span class="id" title="var">X</span></span> to <span class="inlinecode">0</span>: 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">dec_while</span> : <span class="id" title="var">decorated</span> :=<br/>
&nbsp;&nbsp;&lt;{<br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">X</span> ≠ 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> ∧ (<span class="id" title="var">X</span> ≠ 0) <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> - 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> ∧  <span class="id" title="var">X</span> = 0<span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = 0 <span style='letter-spacing:-.4em;'>}</span>} }&gt;.<br/>
</div>

<div class="doc">
<a id="lab135"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 It is easy to go from a <span class="inlinecode"><span class="id" title="var">dcom</span></span> to a <span class="inlinecode"><span class="id" title="var">com</span></span> by erasing all
    annotations. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">extract</span> (<span class="id" title="var">d</span> : <span class="id" title="var">dcom</span>) : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">d</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">DCSkip</span> <span class="id" title="var">_</span>           ⇒ <span class="id" title="var">CSkip</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">DCSeq</span> <span class="id" title="var">d<sub>1</sub></span> <span class="id" title="var">d<sub>2</sub></span>        ⇒ <span class="id" title="var">CSeq</span> (<span class="id" title="var">extract</span> <span class="id" title="var">d<sub>1</sub></span>) (<span class="id" title="var">extract</span> <span class="id" title="var">d<sub>2</sub></span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">DCAsgn</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span> <span class="id" title="var">_</span>       ⇒ <span class="id" title="var">CAsgn</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">DCIf</span> <span class="id" title="var">b</span> <span class="id" title="var">_</span> <span class="id" title="var">d<sub>1</sub></span> <span class="id" title="var">_</span> <span class="id" title="var">d<sub>2</sub></span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">CIf</span> <span class="id" title="var">b</span> (<span class="id" title="var">extract</span> <span class="id" title="var">d<sub>1</sub></span>) (<span class="id" title="var">extract</span> <span class="id" title="var">d<sub>2</sub></span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">DCWhile</span> <span class="id" title="var">b</span> <span class="id" title="var">_</span> <span class="id" title="var">d</span> <span class="id" title="var">_</span>    ⇒ <span class="id" title="var">CWhile</span> <span class="id" title="var">b</span> (<span class="id" title="var">extract</span> <span class="id" title="var">d</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">DCPre</span> <span class="id" title="var">_</span> <span class="id" title="var">d</span>          ⇒ <span class="id" title="var">extract</span> <span class="id" title="var">d</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">DCPost</span> <span class="id" title="var">d</span> <span class="id" title="var">_</span>         ⇒ <span class="id" title="var">extract</span> <span class="id" title="var">d</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">extract_dec</span> (<span class="id" title="var">dec</span> : <span class="id" title="var">decorated</span>) : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">dec</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Decorated</span> <span class="id" title="var">P</span> <span class="id" title="var">d</span> ⇒ <span class="id" title="var">extract</span> <span class="id" title="var">d</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a id="lab136"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 It is also straightforward to extract the precondition and
    postcondition from a decorated program. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">pre_dec</span> (<span class="id" title="var">dec</span> : <span class="id" title="var">decorated</span>) : <span class="id" title="var">Assertion</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">dec</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Decorated</span> <span class="id" title="var">P</span> <span class="id" title="var">d</span> ⇒ <span class="id" title="var">P</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">post</span> (<span class="id" title="var">d</span> : <span class="id" title="var">dcom</span>) : <span class="id" title="var">Assertion</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">d</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">DCSkip</span> <span class="id" title="var">P</span>                ⇒ <span class="id" title="var">P</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">DCSeq</span> <span class="id" title="var">_</span> <span class="id" title="var">d<sub>2</sub></span>              ⇒ <span class="id" title="var">post</span> <span class="id" title="var">d<sub>2</sub></span><br/>
&nbsp;&nbsp;| <span class="id" title="var">DCAsgn</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Q</span>            ⇒ <span class="id" title="var">Q</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">DCIf</span>  <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Q</span>       ⇒ <span class="id" title="var">Q</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">DCWhile</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Q</span>         ⇒ <span class="id" title="var">Q</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">DCPre</span> <span class="id" title="var">_</span> <span class="id" title="var">d</span>               ⇒ <span class="id" title="var">post</span> <span class="id" title="var">d</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">DCPost</span> <span class="id" title="var">_</span> <span class="id" title="var">Q</span>              ⇒ <span class="id" title="var">Q</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">post_dec</span> (<span class="id" title="var">dec</span> : <span class="id" title="var">decorated</span>) : <span class="id" title="var">Assertion</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">dec</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Decorated</span> <span class="id" title="var">P</span> <span class="id" title="var">d</span> ⇒ <span class="id" title="var">post</span> <span class="id" title="var">d</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a id="lab137"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 When is a decorated program correct? 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">outer_triple_valid</span> (<span class="id" title="var">dec</span> : <span class="id" title="var">decorated</span>) :=<br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">pre_dec</span> <span class="id" title="var">dec</span><span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">extract_dec</span> <span class="id" title="var">dec</span> <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">post_dec</span> <span class="id" title="var">dec</span><span style='letter-spacing:-.4em;'>}</span>}.<br/>
</div>

<div class="doc">
<a id="lab138"></a><h3 class="section"> </h3>

</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">dec_while_triple_correct</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">outer_triple_valid</span> <span class="id" title="var">dec_while</span><br/>
&nbsp;&nbsp;&nbsp;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">X</span> ≠ 0 <span class="id" title="tactic">do</span> <span class="id" title="var">X</span> := <span class="id" title="var">X</span> - 1 <span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = 0 <span style='letter-spacing:-.4em;'>}</span>}.<br/>
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')">
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
Remember that the outer Hoare triple of a decorated program is
    just a <span class="inlinecode"><span class="id" title="keyword">Prop</span></span>; thus, to show that it is <i>valid</i>, we need to
    produce a proof of this proposition.

<div class="paragraph"> </div>

    We will do this by extracting "proof obligations" from the
    decorations sprinkled through the program.

<div class="paragraph"> </div>

    These obligations are often called <i>verification conditions</i>,
    because they are the facts that must be verified to see that the
    decorations are locally consistent and thus constitute a proof of
    correctness. 
<div class="paragraph"> </div>

<a id="lab139"></a><h2 class="section">Extracting Verification Conditions</h2>

<div class="paragraph"> </div>

 The function <span class="inlinecode"><span class="id" title="var">verification_conditions</span></span> takes a decorated command
    <span class="inlinecode"><span class="id" title="var">d</span></span> together with a precondition <span class="inlinecode"><span class="id" title="var">P</span></span> and returns a <i>proposition</i>
    that, if it can be proved, implies that the triple
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P</span><span style='letter-spacing:-.4em;'>}</span>} (<span class="id" title="var">extract</span> <span class="id" title="var">d</span>) <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">post</span> <span class="id" title="var">d</span><span style='letter-spacing:-.4em;'>}</span>}
</span>    is valid.

<div class="paragraph"> </div>

    It does this by walking over <span class="inlinecode"><span class="id" title="var">d</span></span> and generating a big conjunction
    that includes

<div class="paragraph"> </div>

<ul class="doclist">
<li> local consistency checks for each form of command, plus

<div class="paragraph"> </div>


</li>
<li> uses of <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> to bridge the gap between the assertions found
      inside a decorated command and the assertions imposed by its
      context; these uses correspond to applications of the
      consequence rule. 
</li>
</ul>

<div class="paragraph"> </div>

<a id="lab140"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

<ul class="doclist">
<li> The decorated command
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">skip</span> <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">Q</span><span style='letter-spacing:-.4em;'>}</span>}
</span>      is locally consistent with respect to a precondition <span class="inlinecode"><span class="id" title="var">P</span></span> if
      <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>.

</li>
</ul>
<a id="lab141"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

<ul class="doclist">
<li> The sequential composition of <span class="inlinecode"><span class="id" title="var">d<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">d<sub>2</sub></span></span> is locally
      consistent with respect <span class="inlinecode"><span class="id" title="var">P</span></span> if <span class="inlinecode"><span class="id" title="var">d<sub>1</sub></span></span> is locally consistent with
      respect to <span class="inlinecode"><span class="id" title="var">P</span></span> and <span class="inlinecode"><span class="id" title="var">d<sub>2</sub></span></span> is locally consistent with respect to
      the postcondition of <span class="inlinecode"><span class="id" title="var">d<sub>1</sub></span></span>. 
</li>
</ul>
<a id="lab142"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

<ul class="doclist">
<li> An assignment
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">a</span> <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">Q</span><span style='letter-spacing:-.4em;'>}</span>}
</span>      is locally consistent with respect to a precondition <span class="inlinecode"><span class="id" title="var">P</span></span> if:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">Q</span> [<span class="id" title="var">X</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span> <span class="id" title="var">a</span>]
</span>
</li>
</ul>
<a id="lab143"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

<ul class="doclist">
<li> A conditional
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P<sub>1</sub></span><span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">d<sub>1</sub></span> <span class="id" title="keyword">else</span> <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P<sub>2</sub></span><span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">d<sub>2</sub></span> <span class="id" title="keyword">end</span> <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">Q</span><span style='letter-spacing:-.4em;'>}</span>}
</span>      is locally consistent with respect to precondition <span class="inlinecode"><span class="id" title="var">P</span></span> if

<div class="paragraph"> </div>

         (1) <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">∧</span> <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> <span class="inlinecode"><span class="id" title="var">P<sub>1</sub></span></span>

<div class="paragraph"> </div>

         (2) <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">∧</span> <span class="inlinecode">¬<span class="id" title="var">b</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> <span class="inlinecode"><span class="id" title="var">P<sub>2</sub></span></span>

<div class="paragraph"> </div>

         (3) <span class="inlinecode"><span class="id" title="var">d<sub>1</sub></span></span> is locally consistent with respect to <span class="inlinecode"><span class="id" title="var">P<sub>1</sub></span></span>

<div class="paragraph"> </div>

         (4) <span class="inlinecode"><span class="id" title="var">d<sub>2</sub></span></span> is locally consistent with respect to <span class="inlinecode"><span class="id" title="var">P<sub>2</sub></span></span>

<div class="paragraph"> </div>

         (5) <span class="inlinecode"><span class="id" title="var">post</span></span> <span class="inlinecode"><span class="id" title="var">d<sub>1</sub></span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>

<div class="paragraph"> </div>

         (6) <span class="inlinecode"><span class="id" title="var">post</span></span> <span class="inlinecode"><span class="id" title="var">d<sub>2</sub></span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>

</li>
</ul>
<a id="lab144"></a><h3 class="section"> </h3>
<ul class="doclist">
<li> A loop
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">Q</span><span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">d</span> <span class="id" title="keyword">end</span> <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">R</span><span style='letter-spacing:-.4em;'>}</span>}
</span>      is locally consistent with respect to precondition <span class="inlinecode"><span class="id" title="var">P</span></span> if:

<div class="paragraph"> </div>

         (1) <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> <span class="inlinecode"><span class="id" title="var">post</span></span> <span class="inlinecode"><span class="id" title="var">d</span></span>

<div class="paragraph"> </div>

         (2) <span class="inlinecode"><span class="id" title="var">post</span></span> <span class="inlinecode"><span class="id" title="var">d</span></span> <span class="inlinecode">∧</span> <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>

<div class="paragraph"> </div>

         (3) <span class="inlinecode"><span class="id" title="var">post</span></span> <span class="inlinecode"><span class="id" title="var">d</span></span> <span class="inlinecode">∧</span> <span class="inlinecode">¬<span class="id" title="var">b</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> <span class="inlinecode"><span class="id" title="var">R</span></span>

<div class="paragraph"> </div>

         (4) <span class="inlinecode"><span class="id" title="var">d</span></span> is locally consistent with respect to <span class="inlinecode"><span class="id" title="var">Q</span></span>

</li>
</ul>

<div class="paragraph"> </div>

<a id="lab145"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

<ul class="doclist">
<li> A command with an extra assertion at the beginning
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">Q</span><span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">d</span>
</span>      is locally consistent with respect to a precondition <span class="inlinecode"><span class="id" title="var">P</span></span> if:

<div class="paragraph"> </div>

        (1) <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>

<div class="paragraph"> </div>

        (1) <span class="inlinecode"><span class="id" title="var">d</span></span> is locally consistent with respect to <span class="inlinecode"><span class="id" title="var">Q</span></span>

</li>
</ul>
<a id="lab146"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

<ul class="doclist">
<li> A command with an extra assertion at the end
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">d</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">Q</span><span style='letter-spacing:-.4em;'>}</span>}
</span>      is locally consistent with respect to a precondition <span class="inlinecode"><span class="id" title="var">P</span></span> if:

<div class="paragraph"> </div>

        (1) <span class="inlinecode"><span class="id" title="var">d</span></span> is locally consistent with respect to <span class="inlinecode"><span class="id" title="var">P</span></span>

<div class="paragraph"> </div>

        (2) <span class="inlinecode"><span class="id" title="var">post</span></span> <span class="inlinecode"><span class="id" title="var">d</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>

</li>
</ul>

<div class="paragraph"> </div>

<a id="lab147"></a><h3 class="section"> </h3>

</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">verification_conditions</span> (<span class="id" title="var">P</span> : <span class="id" title="var">Assertion</span>) (<span class="id" title="var">d</span> : <span class="id" title="var">dcom</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">d</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">DCSkip</span> <span class="id" title="var">Q</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">Q</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">DCSeq</span> <span class="id" title="var">d<sub>1</sub></span> <span class="id" title="var">d<sub>2</sub></span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">verification_conditions</span> <span class="id" title="var">P</span> <span class="id" title="var">d<sub>1</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧ <span class="id" title="var">verification_conditions</span> (<span class="id" title="var">post</span> <span class="id" title="var">d<sub>1</sub></span>) <span class="id" title="var">d<sub>2</sub></span><br/>
&nbsp;&nbsp;| <span class="id" title="var">DCAsgn</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span> <span class="id" title="var">Q</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">Q</span> [<span class="id" title="var">X</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span> <span class="id" title="var">a</span>])<br/>
&nbsp;&nbsp;| <span class="id" title="var">DCIf</span> <span class="id" title="var">b</span> <span class="id" title="var">P<sub>1</sub></span> <span class="id" title="var">d<sub>1</sub></span> <span class="id" title="var">P<sub>2</sub></span> <span class="id" title="var">d<sub>2</sub></span> <span class="id" title="var">Q</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">P</span> ∧ <span class="id" title="var">b</span>) <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">P<sub>1</sub></span>)%<span class="id" title="var">assertion</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧ ((<span class="id" title="var">P</span> ∧ ¬<span class="id" title="var">b</span>) <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">P<sub>2</sub></span>)%<span class="id" title="var">assertion</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧ (<span class="id" title="var">post</span> <span class="id" title="var">d<sub>1</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">Q</span>) ∧ (<span class="id" title="var">post</span> <span class="id" title="var">d<sub>2</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">Q</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧ <span class="id" title="var">verification_conditions</span> <span class="id" title="var">P<sub>1</sub></span> <span class="id" title="var">d<sub>1</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧ <span class="id" title="var">verification_conditions</span> <span class="id" title="var">P<sub>2</sub></span> <span class="id" title="var">d<sub>2</sub></span><br/>
&nbsp;&nbsp;| <span class="id" title="var">DCWhile</span> <span class="id" title="var">b</span> <span class="id" title="var">Pbody</span> <span class="id" title="var">d</span> <span class="id" title="var">Ppost</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;post&nbsp;d&nbsp;is&nbsp;the&nbsp;loop&nbsp;invariant&nbsp;and&nbsp;the&nbsp;initial<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;precondition&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">post</span> <span class="id" title="var">d</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧ ((<span class="id" title="var">post</span> <span class="id" title="var">d</span>  ∧ <span class="id" title="var">b</span>) <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">Pbody</span>)%<span class="id" title="var">assertion</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧ ((<span class="id" title="var">post</span> <span class="id" title="var">d</span>  ∧ ¬<span class="id" title="var">b</span>) <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">Ppost</span>)%<span class="id" title="var">assertion</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧ <span class="id" title="var">verification_conditions</span> <span class="id" title="var">Pbody</span> <span class="id" title="var">d</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">DCPre</span> <span class="id" title="var">P'</span> <span class="id" title="var">d</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">P'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧ <span class="id" title="var">verification_conditions</span> <span class="id" title="var">P'</span> <span class="id" title="var">d</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">DCPost</span> <span class="id" title="var">d</span> <span class="id" title="var">Q</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">verification_conditions</span> <span class="id" title="var">P</span> <span class="id" title="var">d</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧ (<span class="id" title="var">post</span> <span class="id" title="var">d</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">Q</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a id="lab148"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 The key theorem states that <span class="inlinecode"><span class="id" title="var">verification_conditions</span></span> does its job
    correctly.  Not surprisingly, we need to use each of the Hoare
    Logic rules at some point in the proof. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">verification_correct</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">d</span> <span class="id" title="var">P</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">verification_conditions</span> <span class="id" title="var">P</span> <span class="id" title="var">d</span> → <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P</span><span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">extract</span> <span class="id" title="var">d</span> <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">post</span> <span class="id" title="var">d</span><span style='letter-spacing:-.4em;'>}</span>}.<br/>
<div class="togglescript" id="proofcontrol2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')"><span class="show"></span></div>
<div class="proofscript" id="proof2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">d</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Skip&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">hoare_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">hoare_skip</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">hoare_seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">IHd2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">IHd1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Asgn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">hoare_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">hoare_asgn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;If&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HPre1</span> [<span class="id" title="var">HPre2</span> [<span class="id" title="var">Hd<sub>1</sub></span> [<span class="id" title="var">Hd<sub>2</sub></span> [<span class="id" title="var">HThen</span> <span class="id" title="var">HElse</span>] ] ] ] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHd1</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HThen</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">IHd1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHd2</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HElse</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">IHd2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">hoare_if</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">hoare_consequence</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">hoare_consequence</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;While&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hpre</span> [<span class="id" title="var">Hbody1</span> [<span class="id" title="var">Hpost1</span>  <span class="id" title="var">Hd</span>] ] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">hoare_consequence</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">hoare_while</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">hoare_consequence_pre</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Pre&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HP</span> <span class="id" title="var">Hd</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">hoare_consequence_pre</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Post&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hd</span> <span class="id" title="var">HQ</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">hoare_consequence_post</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab149"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Now that all the pieces are in place, we can define what it means
    to verify an entire program. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">verification_conditions_dec</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">dec</span> : <span class="id" title="var">decorated</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">dec</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Decorated</span> <span class="id" title="var">P</span> <span class="id" title="var">d</span> ⇒ <span class="id" title="var">verification_conditions</span> <span class="id" title="var">P</span> <span class="id" title="var">d</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Corollary</span> <span class="id" title="var">verification_correct_dec</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">dec</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">verification_conditions_dec</span> <span class="id" title="var">dec</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">outer_triple_valid</span> <span class="id" title="var">dec</span>.<br/>
<div class="togglescript" id="proofcontrol3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')"><span class="show"></span></div>
<div class="proofscript" id="proof3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">P</span> <span class="id" title="var">d</span>]. <span class="id" title="tactic">apply</span> <span class="id" title="var">verification_correct</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab150"></a><h2 class="section">Automation</h2>

<div class="paragraph"> </div>

 The propositions generated by <span class="inlinecode"><span class="id" title="var">verification_conditions</span></span> are fairly
    big and contain many conjuncts that are essentially trivial. 
</div>
<div class="code">

<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">verification_conditions_dec</span> <span class="id" title="var">dec_while</span>.<br/>
<span class="comment">(*&nbsp;==&gt;<br/>
&nbsp;&nbsp;&nbsp;((fun&nbsp;_&nbsp;:&nbsp;state&nbsp;=&gt;&nbsp;True)&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(fun&nbsp;_&nbsp;:&nbsp;state&nbsp;=&gt;&nbsp;True))&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;((fun&nbsp;st&nbsp;:&nbsp;state&nbsp;=&gt;&nbsp;True&nbsp;/\&nbsp;negb&nbsp;(st&nbsp;X&nbsp;=?&nbsp;0)&nbsp;=&nbsp;true)&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(fun&nbsp;st&nbsp;:&nbsp;state&nbsp;=&gt;&nbsp;True&nbsp;/\&nbsp;st&nbsp;X&nbsp;&lt;&gt;&nbsp;0))&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;((fun&nbsp;st&nbsp;:&nbsp;state&nbsp;=&gt;&nbsp;True&nbsp;/\&nbsp;negb&nbsp;(st&nbsp;X&nbsp;=?&nbsp;0)&nbsp;&lt;&gt;&nbsp;true)&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(fun&nbsp;st&nbsp;:&nbsp;state&nbsp;=&gt;&nbsp;True&nbsp;/\&nbsp;st&nbsp;X&nbsp;=&nbsp;0))&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;(fun&nbsp;st&nbsp;:&nbsp;state&nbsp;=&gt;&nbsp;True&nbsp;/\&nbsp;st&nbsp;X&nbsp;&lt;&gt;&nbsp;0)&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(fun&nbsp;_&nbsp;:&nbsp;state&nbsp;=&gt;&nbsp;True)&nbsp;<span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">-</span> <span class="inlinecode">1</span>)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;(fun&nbsp;st&nbsp;:&nbsp;state&nbsp;=&gt;&nbsp;True&nbsp;/\&nbsp;st&nbsp;X&nbsp;=&nbsp;0)&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(fun&nbsp;st&nbsp;:&nbsp;state&nbsp;=&gt;&nbsp;st&nbsp;X&nbsp;=&nbsp;0)<br/>
:&nbsp;Prop<br/>
*)</span><br/>
</div>

<div class="doc">
<a id="lab151"></a><h3 class="section"> </h3>
 Fortunately, our <span class="inlinecode"><span class="id" title="var">verify_assn</span></span> tactic can generally take care of
    most or all of them. 
</div>
<div class="code">
<span class="id" title="keyword">Example</span> <span class="id" title="var">vc_dec_while</span> : <span class="id" title="var">verification_conditions_dec</span> <span class="id" title="var">dec_while</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">verify_assn</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab152"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 To automate the overall process of verification, we can use
    <span class="inlinecode"><span class="id" title="var">verification_correct</span></span> to extract the verification conditions, use
    <span class="inlinecode"><span class="id" title="var">verify_assn</span></span> to verify them as much as it can, and finally tidy
    up any remaining bits by hand.  
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">verify</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">verification_correct</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">verify_assn</span>.<br/>
</div>

<div class="doc">
<a id="lab153"></a><h3 class="section"> </h3>
 Here's the final, formal proof that dec_while is correct. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">dec_while_correct</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">outer_triple_valid</span> <span class="id" title="var">dec_while</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">verify</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab154"></a><h1 class="section">Finding Loop Invariants</h1>

<div class="paragraph"> </div>

 Once the outer pre- and postcondition are chosen, the only
    creative part in verifying programs using Hoare Logic is finding
    the right loop invariants... 
<div class="paragraph"> </div>

<a id="lab155"></a><h2 class="section">Example: Slow Subtraction</h2>

<div class="paragraph"> </div>

 The following program subtracts the value of <span class="inlinecode"><span class="id" title="var">X</span></span> from the value of
    <span class="inlinecode"><span class="id" title="var">Y</span></span> by repeatedly decrementing both <span class="inlinecode"><span class="id" title="var">X</span></span> and <span class="inlinecode"><span class="id" title="var">Y</span></span>.  We want to verify its
    correctness with respect to the pre- and postconditions shown:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = <span class="id" title="var">m</span> ∧ <span class="id" title="var">Y</span> = <span class="id" title="var">n</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">X</span> ≠ 0 <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">Y</span> - 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> - 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Y</span> = <span class="id" title="var">n</span> - <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>
<div class="paragraph"> </div>

<a id="lab156"></a><h3 class="section"> </h3>
 To verify this program, we need to find an invariant <span class="inlinecode"><span class="id" title="var">Inv</span></span> for the
    loop.  As a first step we can leave <span class="inlinecode"><span class="id" title="var">Inv</span></span> as an unknown and build a
    <i>skeleton</i> for the proof by applying the rules for local
    consistency, working from the end of the program to the beginning,
    as usual, and without any thinking at all yet. 
<div class="paragraph"> </div>

<a id="lab157"></a><h3 class="section"> </h3>
 This leads to the following skeleton:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1)    <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = <span class="id" title="var">m</span> ∧ <span class="id" title="var">Y</span> = <span class="id" title="var">n</span> <span style='letter-spacing:-.4em;'>}</span>}  <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>                   (<span class="id" title="var">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(2)    <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Inv</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">X</span> ≠ 0 <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(3)              <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Inv</span> ∧ <span class="id" title="var">X</span> ≠ 0 <span style='letter-spacing:-.4em;'>}</span>}  <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>          (<span class="id" title="var">c</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(4)              <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Inv</span> [<span class="id" title="var">X</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span> <span class="id" title="var">X</span>-1] [<span class="id" title="var">Y</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span> <span class="id" title="var">Y</span>-1] <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">Y</span> - 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(5)              <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Inv</span> [<span class="id" title="var">X</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span> <span class="id" title="var">X</span>-1] <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> - 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(6)              <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Inv</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(7)    <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Inv</span> ∧ ¬(<span class="id" title="var">X</span> ≠ 0) <span style='letter-spacing:-.4em;'>}</span>}  <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>                (<span class="id" title="var">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(8)    <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Y</span> = <span class="id" title="var">n</span> - <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}
</span><a id="lab158"></a><h3 class="section"> </h3>
 By examining this skeleton, we can see that any valid <span class="inlinecode"><span class="id" title="var">Inv</span></span> will
    have to respect three conditions:
<ul class="doclist">
<li> (a) it must be <i>weak</i> enough to be implied by the loop's
      precondition, i.e., (1) must imply (2);

</li>
<li> (b) it must be <i>strong</i> enough to imply the program's postcondition,
      i.e., (7) must imply (8);

</li>
<li> (c) it must be <i>preserved</i> by each iteration of the loop (given
      that the loop guard evaluates to true), i.e., (3) must imply (4). 
</li>
</ul>

<div class="paragraph"> </div>

<a id="lab159"></a><h3 class="section"> </h3>

</div>
<div class="code">
<span class="comment">(*&nbsp;WORK&nbsp;IN&nbsp;CLASS&nbsp;*)</span><br/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">subtract_slowly_dec'</span> (<span class="id" title="var">m</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">decorated</span> :=<br/>
&nbsp;&nbsp;&lt;{<br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = <span class="id" title="var">m</span> ∧  <span class="id" title="var">Z</span> = <span class="id" title="var">p</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">X</span> ≠ 0 <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := <span class="id" title="var">Z</span> - 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>} ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> - 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Z</span> = <span class="id" title="var">p</span> - <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>} }&gt;.<br/>
</div>

<div class="doc">
<a id="lab160"></a><h2 class="section">Example: Parity</h2>

<div class="paragraph"> </div>

 Here is a cute way of computing the parity of a value initially
    stored in <span class="inlinecode"><span class="id" title="var">X</span></span>, due to Daniel Cristofani.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> 2 ≤ <span class="id" title="var">X</span> <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> - 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = <span class="id" title="var">parity</span> <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>    The <span class="inlinecode"><span class="id" title="var">parity</span></span> function used in the specification is defined in
    Coq as follows: 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">parity</span> <span class="id" title="var">x</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">x</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ 0<br/>
&nbsp;&nbsp;| 1 ⇒ 1<br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> (<span class="id" title="var">S</span> <span class="id" title="var">x'</span>) ⇒ <span class="id" title="var">parity</span> <span class="id" title="var">x'</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a id="lab161"></a><h3 class="section"> </h3>

</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">parity_dec</span> (<span class="id" title="var">m</span>:<span class="id" title="var">nat</span>) : <span class="id" title="var">decorated</span> :=<br/>
&nbsp;&nbsp;&lt;{<br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> 2 ≤ <span class="id" title="var">X</span> <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> - 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = <span class="id" title="var">parity</span> <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>} }&gt;.<br/>
</div>

<div class="doc">
<a id="lab162"></a><h2 class="section">Example: Finding Square Roots</h2>

<div class="paragraph"> </div>

 The following program computes the integer square root of <span class="inlinecode"><span class="id" title="var">X</span></span>
    by naive iteration:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span>=<span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> (<span class="id" title="var">Z</span>+1)*(<span class="id" title="var">Z</span>+1) ≤ <span class="id" title="var">X</span> <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := <span class="id" title="var">Z</span>+1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Z</span>×<span class="id" title="var">Z</span>≤<span class="id" title="var">m</span> ∧ <span class="id" title="var">m</span>&lt;(<span class="id" title="var">Z</span>+1)*(<span class="id" title="var">Z</span>+1) <span style='letter-spacing:-.4em;'>}</span>}
</span>
</div>
<div class="code">

<span class="comment">(*&nbsp;WORK&nbsp;IN&nbsp;CLASS&nbsp;*)</span><br/>
</div>

<div class="doc">
<a id="lab163"></a><h2 class="section">Example: Squaring</h2>

<div class="paragraph"> </div>

 Here is a program that squares <span class="inlinecode"><span class="id" title="var">X</span></span> by repeated addition:
<br/>
<span class="inlinecode">&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">Y</span> ≠ <span class="id" title="var">X</span>  <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := <span class="id" title="var">Z</span> + <span class="id" title="var">X</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">Y</span> + 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Z</span> = <span class="id" title="var">m</span>×<span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>
</div>
<div class="code">

<span class="comment">(*&nbsp;WORK&nbsp;IN&nbsp;CLASS&nbsp;*)</span><br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab164"></a><h1 class="section">Weakest Preconditions (Optional)</h1>

<div class="paragraph"> </div>

 A useless (though valid) Hoare triple:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">False</span> <span style='letter-spacing:-.4em;'>}</span>}  <span class="id" title="var">X</span> := <span class="id" title="var">Y</span> + 1  <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> ≤ 5 <span style='letter-spacing:-.4em;'>}</span>}
</span>    A better precondition:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Y</span> ≤ 4 ∧ <span class="id" title="var">Z</span> = 0 <span style='letter-spacing:-.4em;'>}</span>}  <span class="id" title="var">X</span> := <span class="id" title="var">Y</span> + 1 <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> ≤ 5 <span style='letter-spacing:-.4em;'>}</span>}
</span>    The <i>best</i> precondition:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Y</span> ≤ 4 <span style='letter-spacing:-.4em;'>}</span>}  <span class="id" title="var">X</span> := <span class="id" title="var">Y</span> + 1  <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> ≤ 5 <span style='letter-spacing:-.4em;'>}</span>}
</span>
<div class="paragraph"> </div>

 Assertion <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">≤</span> <span class="inlinecode">4</span> is a <i>weakest precondition</i> of command <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">:=</span>
    <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">+</span> <span class="inlinecode">1</span> with respect to postcondition <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">≤</span> <span class="inlinecode">5</span>.  Think of <i>weakest</i>
    here as meaning "easiest to satisfy": a weakest precondition is
    one that as many states as possible can satisfy. 
<div class="paragraph"> </div>

<a id="lab165"></a><h3 class="section"> </h3>
 <span class="inlinecode"><span class="id" title="var">P</span></span> is a weakest precondition of command <span class="inlinecode"><span class="id" title="var">c</span></span> for postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span>
    if

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">P</span></span> is a precondition, that is, <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P</span><span style='letter-spacing:-.4em;'>}</span>}</span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">Q</span><span style='letter-spacing:-.4em;'>}</span>}</span>; and

</li>
<li> <span class="inlinecode"><span class="id" title="var">P</span></span> is at least as weak as all other preconditions, that is,
        if <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P'</span><span style='letter-spacing:-.4em;'>}</span>}</span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">Q</span><span style='letter-spacing:-.4em;'>}</span>}</span> then <span class="inlinecode"><span class="id" title="var">P'</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> <span class="inlinecode"><span class="id" title="var">P</span></span>.

</li>
</ul>
 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">is_wp</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">Q</span> :=<br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P</span><span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">c</span> <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">Q</span><span style='letter-spacing:-.4em;'>}</span>} ∧<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P'</span>, <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P'</span><span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">c</span> <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">Q</span><span style='letter-spacing:-.4em;'>}</span>} → (<span class="id" title="var">P'</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">P</span>).<br/>
</div>

<div class="doc">
<a id="lab166"></a><h3 class="section"> </h3>
<a id="lab167"></a><h4 class="section">Exercise: 1 star, standard, optional (wp)</h4>
 What are weakest preconditions of the following commands
    for the following postconditions?
<br/>
<span class="inlinecode">&nbsp;&nbsp;1) <span style='letter-spacing:-.4em;'>{</span>{ ? <span style='letter-spacing:-.4em;'>}</span>}  <span class="id" title="var">skip</span>  <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = 5 <span style='letter-spacing:-.4em;'>}</span>}<br/>
<br/>
&nbsp;&nbsp;2) <span style='letter-spacing:-.4em;'>{</span>{ ? <span style='letter-spacing:-.4em;'>}</span>}  <span class="id" title="var">X</span> := <span class="id" title="var">Y</span> + <span class="id" title="var">Z</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = 5 <span style='letter-spacing:-.4em;'>}</span>}<br/>
<br/>
&nbsp;&nbsp;3) <span style='letter-spacing:-.4em;'>{</span>{ ? <span style='letter-spacing:-.4em;'>}</span>}  <span class="id" title="var">X</span> := <span class="id" title="var">Y</span>  <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = <span class="id" title="var">Y</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
<br/>
&nbsp;&nbsp;4) <span style='letter-spacing:-.4em;'>{</span>{ ? <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">X</span> = 0 <span class="id" title="keyword">then</span> <span class="id" title="var">Y</span> := <span class="id" title="var">Z</span> + 1 <span class="id" title="keyword">else</span> <span class="id" title="var">Y</span> := <span class="id" title="var">W</span> + 2 <span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Y</span> = 5 <span style='letter-spacing:-.4em;'>}</span>}<br/>
<br/>
&nbsp;&nbsp;5) <span style='letter-spacing:-.4em;'>{</span>{ ? <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := 5<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = 0 <span style='letter-spacing:-.4em;'>}</span>}<br/>
<br/>
&nbsp;&nbsp;6) <span style='letter-spacing:-.4em;'>{</span>{ ? <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">true</span> <span class="id" title="tactic">do</span> <span class="id" title="var">X</span> := 0 <span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = 0 <span style='letter-spacing:-.4em;'>}</span>}
</span>
</div>
<div class="code">
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab168"></a><h4 class="section">Exercise: 3 stars, advanced, optional (is_wp_formal)</h4>
 Prove formally, using the definition of <span class="inlinecode"><span class="id" title="var">hoare_triple</span></span>, that <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">≤</span> <span class="inlinecode">4</span>
    is indeed a weakest precondition of <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">+</span> <span class="inlinecode">1</span> with respect to
    postcondition <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">≤</span> <span class="inlinecode">5</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">is_wp_example</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">is_wp</span> (<span class="id" title="var">Y</span> ≤ 4) &lt;{<span class="id" title="var">X</span> := <span class="id" title="var">Y</span> + 1}&gt; (<span class="id" title="var">X</span> ≤ 5).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab169"></a><h4 class="section">Exercise: 2 stars, advanced, optional (hoare_asgn_weakest)</h4>
 Show that the precondition in the rule <span class="inlinecode"><span class="id" title="var">hoare_asgn</span></span> is in fact the
    weakest precondition. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">hoare_asgn_weakest</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">Q</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">is_wp</span> (<span class="id" title="var">Q</span> [<span class="id" title="var">X</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span> <span class="id" title="var">a</span>]) &lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">a</span> }&gt; <span class="id" title="var">Q</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab170"></a><h4 class="section">Exercise: 2 stars, advanced, optional (hoare_havoc_weakest)</h4>
 Show that your <span class="inlinecode"><span class="id" title="var">havoc_pre</span></span> function from the <span class="inlinecode"><span class="id" title="var">himp_hoare</span></span> exercise
    in the <a href="Hoare.html"><span class="inlineref">Hoare</span></a> chapter returns a weakest precondition. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">hoare_havoc_weakest</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="var">Assertion</span>) (<span class="id" title="var">X</span> : <span class="id" title="var">string</span>),<br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">P</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">havoc</span> <span class="id" title="var">X</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Q</span> <span style='letter-spacing:-.4em;'>}</span>} →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">havoc_pre</span> <span class="id" title="var">X</span> <span class="id" title="var">Q</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Himp2</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab171"></a><h4 class="section">Exercise: 2 stars, advanced, optional (fib_eqn)</h4>
 The Fibonacci function is usually written like this:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">fib</span> <span class="id" title="var">n</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 0 ⇒ 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 1 ⇒ 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <span class="id" title="var">fib</span> (<span class="id" title="var">pred</span> <span class="id" title="var">n</span>) + <span class="id" title="var">fib</span> (<span class="id" title="var">pred</span> (<span class="id" title="var">pred</span> <span class="id" title="var">n</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.
</span>   This doesn't pass Coq's termination checker, but here is a
   slightly clunkier definition that does: 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">fib</span> <span class="id" title="var">n</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ 1<br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">n'</span> ⇒ <span class="id" title="keyword">match</span> <span class="id" title="var">n'</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 0 ⇒ 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">n''</span> ⇒ <span class="id" title="var">fib</span> <span class="id" title="var">n'</span> + <span class="id" title="var">fib</span> <span class="id" title="var">n''</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
Prove that <span class="inlinecode"><span class="id" title="var">fib</span></span> satisfies the following equation.  You will need this
    as a lemma in the next exercise. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fib_eqn</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">n</span> &gt; 0 →<br/>
&nbsp;&nbsp;<span class="id" title="var">fib</span> <span class="id" title="var">n</span> + <span class="id" title="var">fib</span> (<span class="id" title="var">pred</span> <span class="id" title="var">n</span>) = <span class="id" title="var">fib</span> (1 + <span class="id" title="var">n</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab172"></a><h4 class="section">Exercise: 4 stars, advanced, optional (fib)</h4>
 The following Imp program leaves the value of <span class="inlinecode"><span class="id" title="var">fib</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> in the
    variable <span class="inlinecode"><span class="id" title="var">Y</span></span> when it terminates:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">X</span> ≠ 1 + <span class="id" title="var">n</span> <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">T</span> := <span class="id" title="var">Z</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := <span class="id" title="var">Z</span> + <span class="id" title="var">Y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">T</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := 1 + <span class="id" title="var">X</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>
</span>    Fill in the following definition of <span class="inlinecode"><span class="id" title="var">dfib</span></span> and prove that it
    satisfies this specification:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">dfib</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Y</span> = <span class="id" title="var">fib</span> <span class="id" title="var">n</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>    You will need many uses of <span class="inlinecode"><span class="id" title="var">ap</span></span> in your assertions.
    If all goes well, your proof will be very brief.

</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">T</span> : <span class="id" title="var">string</span> := "T".<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">dfib</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">decorated</span> :=<br/>
&nbsp;&nbsp;&lt;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>} ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>} ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>} ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">X</span> ≠ 1 + <span class="id" title="var">n</span> <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">T</span> := <span class="id" title="var">Z</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := <span class="id" title="var">Z</span> + <span class="id" title="var">Y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">T</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := 1 + <span class="id" title="var">X</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">FILL_IN_HERE</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Y</span> = <span class="id" title="var">fib</span> <span class="id" title="var">n</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;}&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">dfib_correct</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">outer_triple_valid</span> (<span class="id" title="var">dfib</span> <span class="id" title="var">n</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab173"></a><h4 class="section">Exercise: 5 stars, advanced, optional (improve_dcom)</h4>
 The formal decorated programs defined in this section are intended
    to look as similar as possible to the informal ones defined
    earlier.  If we drop this requirement, we can eliminate almost all
    annotations, just requiring final postconditions and loop
    invariants to be provided explicitly.  Do this -- i.e., define a
    new version of dcom with as few annotations as possible and adapt
    the rest of the formal development leading up to the
    <span class="inlinecode"><span class="id" title="var">verification_correct</span></span> theorem. 
</div>
<div class="code">

<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
<font size=-2>&#9744;</font>
</div>

</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>