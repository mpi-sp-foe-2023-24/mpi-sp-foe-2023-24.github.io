<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>StaticIFC: Information Flow Control Type Systems</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/plf.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 2: Programming Language Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">StaticIFC<span class="subtitle">Information Flow Control Type Systems</span></h1>



<div class="doc">
<a id="lab713"></a><h2 class="section">Noninterference</h2>

<div class="paragraph"> </div>

 As explained in Noninterference.v and <a href="RelHoare.html"><span class="inlineref">RelHoare</span></a>, data
    confidentiality is most often expressed formally as a property
    called <i>noninterference</i>.

<div class="paragraph"> </div>

    For formalizing this for Imp programs, we divide the variables as
    either public or secret by assuming a total map <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">pub_vars</span></span>
    between variables and Boolean labels: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">label</span> := <span class="id" title="var">bool</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">public</span> : <span class="id" title="var">label</span> := <span class="id" title="var">true</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">secret</span> : <span class="id" title="var">label</span> := <span class="id" title="var">false</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">pub_vars</span> := <span class="id" title="var">total_map</span> <span class="id" title="var">label</span>.<br/>
</div>

<div class="doc">
<a id="lab714"></a><h3 class="section">Publicly equivalent states</h3>

<div class="paragraph"> </div>

 A noninterference attacker can only observe the values of public
    variables, not of secret ones. We formalize this as a notion of
    <i>publicly equivalent</i> states that agree on the values of all
    public variables, which an attacker can thus not distinguish: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">pub_equiv</span> (<span class="id" title="var">P</span> : <span class="id" title="var">pub_vars</span>) {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> : <span class="id" title="var">total_map</span> <span class="id" title="var">X</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>:<span class="id" title="var">string</span>, <span class="id" title="var">P</span> <span class="id" title="var">x</span> = <span class="id" title="var">true</span> → <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">x</span> = <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">x</span>.<br/>
</div>

<div class="doc">
For some total map <span class="inlinecode"><span class="id" title="var">P</span></span> from variables to Boolean labels,
    <span class="inlinecode"><span class="id" title="var">pub_equiv</span></span> <span class="inlinecode"><span class="id" title="var">P</span></span> is an equivalence relation on states, so reflexive,
    symmetric, and transitive. 
</div>

<div class="doc">
<a id="lab715"></a><h3 class="section">Noninterference</h3>

<div class="paragraph"> </div>

 Program <span class="inlinecode"><span class="id" title="var">c</span></span> is noninterferent if whenever it has two terminating
    runs from two publicly equivalent initial states <span class="inlinecode"><span class="id" title="var">s<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">s<sub>2</sub></span></span>,
    the obtained final states <span class="inlinecode"><span class="id" title="var">s<sub>1</sub>'</span></span> and <span class="inlinecode"><span class="id" title="var">s<sub>2</sub>'</span></span> are also publicly equivalent. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">noninterferent</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> := <span class="id" title="keyword">∀</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>1</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>2</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>2</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span>.<br/>
</div>

<div class="doc">
Intuitively, <span class="inlinecode"><span class="id" title="var">c</span></span> is noninterferent when the value of the public
    variables in the final state can only depend on the value of
    public variables in the initial state, and do not depend on the
    initial value of secret variables. 
<div class="paragraph"> </div>

<a id="lab716"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 A first noninterferent program 
<div class="paragraph"> </div>

 For instance, consider the following command
    (taken from Noninterference.v): 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">secure_com</span> : <span class="id" title="var">com</span> := &lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">X</span>+1; <span class="id" title="var">Y</span> := <span class="id" title="var">X</span>+<span class="id" title="var">Y</span>*2 }&gt;.<br/>
</div>

<div class="doc">
If we assume that variable <span class="inlinecode"><span class="id" title="var">X</span></span> is public and variable <span class="inlinecode"><span class="id" title="var">Y</span></span> is
    secret, we can state noninterference for <span class="inlinecode"><span class="id" title="var">secure_com</span></span> as follows: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">xpub</span> : <span class="id" title="var">pub_vars</span> := (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">public</span>; <span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">secret</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">noninterferent_secure_com</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent</span> <span class="id" title="var">xpub</span> <span class="id" title="var">secure_com</span>.<br/>
</div>

<div class="doc">
We have already proved that <span class="inlinecode"><span class="id" title="var">secure_com</span></span> is indeed noninterferent
    both directly using the semantics (in Noninterference.v) and using
    RHL (in <a href="RelHoare.html"><span class="inlineref">RelHoare</span></a>). Both these proofs were manual though,
    while in this chapter we will show how this proof can be done more
    syntactically using several type systems that enforce
    noninterference for all well-typed programs. 
<div class="paragraph"> </div>

<a id="lab717"></a><h3 class="section">Explicit flows</h3>

<div class="paragraph"> </div>

 Not all programs are noninterferent though. For instance, a
    program that reads the contents of a secret variable and uses that
    to change the value of a public variable is unlikely to be
    noninterferent. We call this an <i>explicit flow</i> and all our type
    systems will prevent all explicit flows. For instance, here is a
    program that has an explicit flow, which breaks noninterference,
    as we already proved in Noninterference.v. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">insecure_com1</span> : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">Y</span>+1; <span class="comment">(*&nbsp;&lt;-&nbsp;bad&nbsp;explicit&nbsp;flow!&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">X</span>+<span class="id" title="var">Y</span>*2 }&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">interferent_insecure_com1</span> :=<br/>
&nbsp;&nbsp;¬<span class="id" title="var">noninterferent</span> <span class="id" title="var">xpub</span> <span class="id" title="var">insecure_com1</span>.<br/>
</div>

<div class="doc">
<a id="lab718"></a><h3 class="section">Not all explicit flows are harmful</h3>

<div class="paragraph"> </div>

 Not all explicit flows break noninterference though. For instance,
    the following variant of <span class="inlinecode"><span class="id" title="var">insecure_com1</span></span> is noninterferent even if
    it has an explicit flow. The reason for this is that the variable
    <span class="inlinecode"><span class="id" title="var">X</span></span> is overwritten with public information in a subsequent assignment. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">secure_com1'</span> : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">Y</span>+1; <span class="comment">(*&nbsp;&lt;-&nbsp;harmless&nbsp;explicit&nbsp;flow&nbsp;(dead&nbsp;store)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span>+1; <span class="comment">(*&nbsp;&lt;-&nbsp;X&nbsp;is&nbsp;overwritten&nbsp;afterwards&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">X</span>+<span class="id" title="var">Y</span>*2 }&gt;.<br/>
</div>

<div class="doc">
Since our type systems will prevent all explicit flows, they will
    also reject <span class="inlinecode"><span class="id" title="var">secure_com1'</span></span>, even if it is secure with respect to
    our attacker model for noninterference, in which the attacker only
    observes the final values of public variables. As usual, our type
    systems will only provide sound syntactic overapproximations of
    the semantic property of noninterference.
<div class="paragraph"> </div>

<a id="lab719"></a><h3 class="section">Implicit flows</h3>

<div class="paragraph"> </div>

 Explicit flows are not the only way to leak secrets: one can also
    leak secrets using the control flow of the program, by branching
    on secrets and then assigning to public variables. We call these
    leaks <i>implicit flows</i>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">insecure_com2</span> : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">Y</span> = 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">Y</span> := 42<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">X</span> := <span class="id" title="var">X</span>+1 <span class="comment">(*&nbsp;&lt;-&nbsp;bad&nbsp;implicit&nbsp;flow!&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> }&gt;.<br/>
</div>

<div class="doc">
Here the expression <span class="inlinecode"><span class="id" title="var">X</span>+1</span> we are assigning to <span class="inlinecode"><span class="id" title="var">X</span></span> is public
    information, but we are doing this assignment after we branched on
    a secret condition <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">=</span> <span class="inlinecode">0</span>, so we are indirectly leaking
    information about the value of <span class="inlinecode"><span class="id" title="var">Y</span></span>. In this case we can infer that
    if <span class="inlinecode"><span class="id" title="var">X</span></span> gets incremented the value of <span class="inlinecode"><span class="id" title="var">Y</span></span> is not <span class="inlinecode">0</span>. We have
    proved in Noninterference.v that this program is insecure, so it
    will be rejected by our type systems which enforce noninterference
    by preventing all implicit flows. 
<div class="paragraph"> </div>

<a id="lab720"></a><h3 class="section">Not all implicit flows are harmful</h3>

<div class="paragraph"> </div>

 Not all implicit flows break noninterference though. For instance,
    in <a href="RelHoare.html"><span class="inlineref">RelHoare</span></a> we saw a program that we proved to be
    noninterferent, even though it contains both an explicit and an
    implicit flow: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">secure_p<sub>2</sub></span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">Y</span> = 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">X</span> := <span class="id" title="var">Y</span> <span class="comment">(*&nbsp;&lt;-&nbsp;harmless&nbsp;explicit&nbsp;flow&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">X</span> := 0 <span class="comment">(*&nbsp;&lt;-&nbsp;harmless&nbsp;implicit&nbsp;flow&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> }&gt;.<br/>
</div>

<div class="doc">
Intuitively, even if this program branches on the secret <span class="inlinecode"><span class="id" title="var">Y</span></span>, it
    always assigns the value <span class="inlinecode">0</span> to <span class="inlinecode"><span class="id" title="var">X</span></span>, so no secret is
    leaked. Still, our type systems will reject programs containing
    any explicit or implicit flows, this one included. 
<div class="paragraph"> </div>

<a id="lab721"></a><h2 class="section">Type systems for noninterference of expressions</h2>

<div class="paragraph"> </div>

 Our type systems will specify the label of an arithmetic or
    Boolean expression in terms of the labels of the read
    variables. So we need a way to combine the labels of two
    sub-expressions, which we call the <i>join</i> or least upper bound of
    the two labels: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">join</span> (<span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">l<sub>2</sub></span> : <span class="id" title="var">label</span>) : <span class="id" title="var">label</span> := <span class="id" title="var">l<sub>1</sub></span> &amp;&amp; <span class="id" title="var">l<sub>2</sub></span>.<br/><hr class='doublespaceincode'/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">join_public_l</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">l</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">join</span> <span class="id" title="var">public</span> <span class="id" title="var">l</span> = <span class="id" title="var">l</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">join_secret_l</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">l</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">join</span> <span class="id" title="var">secret</span> <span class="id" title="var">l</span> = <span class="id" title="var">secret</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab722"></a><h3 class="section">Typing of arithmetic expressions</h3>

<div class="paragraph"> </div>

 <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (T_Num) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>a n &#x2208; public</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (T_Id) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>a X &#x2208; P X</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>a a<sub>1</sub> &#x2208; l<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P <span class="nowrap">&vert;--</span>a a<sub>2</sub> &#x2208; l<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Plus) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>a a<sub>1</sub>+a<sub>2</sub> &#x2208; join l<sub>1</sub> l<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>a a<sub>1</sub> &#x2208; l<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P <span class="nowrap">&vert;--</span>a a<sub>2</sub> &#x2208; l<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Minus) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>a a<sub>1</sub>-a<sub>2</sub> &#x2208; join l<sub>1</sub> l<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>a a<sub>1</sub> &#x2208; l<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P <span class="nowrap">&vert;--</span>a a<sub>2</sub> &#x2208; l<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Mult) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>a a<sub>1</sub>*a<sub>2</sub> &#x2208; join l<sub>1</sub> l<sub>2</sub></td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

<a id="lab723"></a><h3 class="section"> </h3>

</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">aexp_has_label</span> (<span class="id" title="var">P</span>:<span class="id" title="var">pub_vars</span>) : <span class="id" title="var">aexp</span> → <span class="id" title="var">label</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">T_Num</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">a</span> (<span class="id" title="var">ANum</span> <span class="id" title="var">n</span>) \<span class="id" title="keyword">in</span> <span class="id" title="var">public</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">T_Id</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">X</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">a</span> (<span class="id" title="var">AId</span> <span class="id" title="var">X</span>) \<span class="id" title="keyword">in</span> (<span class="id" title="var">P</span> <span class="id" title="var">X</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">T_Plus</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">l<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">a</span> <span class="id" title="var">a<sub>1</sub></span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">a</span> <span class="id" title="var">a<sub>2</sub></span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">a</span> &lt;{ <span class="id" title="var">a<sub>1</sub></span> + <span class="id" title="var">a<sub>2</sub></span> }&gt; \<span class="id" title="keyword">in</span> (<span class="id" title="var">join</span> <span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">l<sub>2</sub></span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">T_Minus</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">l<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">a</span> <span class="id" title="var">a<sub>1</sub></span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">a</span> <span class="id" title="var">a<sub>2</sub></span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">a</span> &lt;{ <span class="id" title="var">a<sub>1</sub></span> - <span class="id" title="var">a<sub>2</sub></span> }&gt; \<span class="id" title="keyword">in</span> (<span class="id" title="var">join</span> <span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">l<sub>2</sub></span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">T_Mult</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">l<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">a</span> <span class="id" title="var">a<sub>1</sub></span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">a</span> <span class="id" title="var">a<sub>2</sub></span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">a</span> &lt;{ <span class="id" title="var">a<sub>1</sub></span> × <span class="id" title="var">a<sub>2</sub></span> }&gt; \<span class="id" title="keyword">in</span> (<span class="id" title="var">join</span> <span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">l<sub>2</sub></span>)<br/>
<br/>
<span class="id" title="keyword">where</span> &quot;P '<span class="nowrap">&vert;--</span>a' a '&#x2208;' l" := (<span class="id" title="var">aexp_has_label</span> <span class="id" title="var">P</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span>).<br/>
</div>

<div class="doc">
<a id="lab724"></a><h3 class="section">Noninterference by typing for arithmetic expressions</h3>

</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">noninterferent_aexp</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">a</span> <span class="id" title="var">a</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">public</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">a</span> = <span class="id" title="var">aeval</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a</span>.<br/>
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Ht</span>. <span class="id" title="var">remember</span> <span class="id" title="var">public</span> <span class="id" title="keyword">as</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Ht</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heql</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">join_public</span> <span class="id" title="var">Heql</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHHt1</span> <span class="id" title="var">H<sub>1</sub></span>). <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHHt2</span> <span class="id" title="var">H<sub>2</sub></span>). <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">join_public</span> <span class="id" title="var">Heql</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHHt1</span> <span class="id" title="var">H<sub>1</sub></span>). <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHHt2</span> <span class="id" title="var">H<sub>2</sub></span>). <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">join_public</span> <span class="id" title="var">Heql</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHHt1</span> <span class="id" title="var">H<sub>1</sub></span>). <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHHt2</span> <span class="id" title="var">H<sub>2</sub></span>). <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab725"></a><h3 class="section">Typing of Boolean expressions</h3>

<div class="paragraph"> </div>

 <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (T_True) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>b true &#x2208; public</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (T_False) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>b false &#x2208; public</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>a a<sub>1</sub> &#x2208; l<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P <span class="nowrap">&vert;--</span>a a<sub>2</sub> &#x2208; l<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Eq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>b a<sub>1</sub>=a<sub>2</sub> &#x2208; join l<sub>1</sub> l<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">...</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>b b &#x2208; l</td>
  <td class="infrulenamecol" rowspan="3">
    (T_Not) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>b ~b &#x2208; l</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>b b<sub>1</sub> &#x2208; l<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P <span class="nowrap">&vert;--</span>b b<sub>2</sub> &#x2208; l<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_And) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>b b<sub>1</sub>&&b<sub>2</sub> &#x2208; join l<sub>1</sub> l<sub>2</sub></td>
  <td></td>
</tr>
</table></center>
</div>

<div class="doc">
<a id="lab726"></a><h3 class="section">Noninterference by typing for Boolean expressions</h3>

</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">noninterferent_bexp</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">b</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">b</span> <span class="id" title="var">b</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">public</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">beval</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">b</span> = <span class="id" title="var">beval</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">b</span>.<br/>
<div class="togglescript" id="proofcontrol2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')"><span class="show"></span></div>
<div class="proofscript" id="proof2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">b</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Ht</span>. <span class="id" title="var">remember</span> <span class="id" title="var">public</span> <span class="id" title="keyword">as</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Ht</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">destruct</span> (<span class="id" title="var">join_public</span> <span class="id" title="var">Heql</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="keyword">in</span> *).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>0</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>0</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>0</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>0</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHHt</span> <span class="id" title="var">Heql</span>). <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHHt1</span> <span class="id" title="var">Logic.eq_refl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHHt2</span> <span class="id" title="var">Logic.eq_refl</span>). <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab727"></a><h3 class="section">Typing of commands</h3>

<div class="paragraph"> </div>

 For commands, we start with a simple type system that doesn't
    allow any branching on secrets, which also prevents all implicit flows. 
<div class="paragraph"> </div>

 For preventing explicit flows when typing assignments, we need to
    define when is it okay for information to <i>flow</i> from an
    expression with label <span class="inlinecode"><span class="id" title="var">l<sub>1</sub></span></span> to a variable with label <span class="inlinecode"><span class="id" title="var">l<sub>1</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">flows</span> (<span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">l<sub>2</sub></span> : <span class="id" title="var">label</span>) : <span class="id" title="var">bool</span> := <span class="id" title="var">l<sub>1</sub></span> || <span class="id" title="var">negb</span> <span class="id" title="var">l<sub>2</sub></span>.<br/>
</div>

<div class="doc">
In particular, we disallow secret expressions to be assigned to
    public variables. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">not_flows_secret_public</span> : <span class="id" title="var">flows</span> <span class="id" title="var">secret</span> <span class="id" title="var">public</span> = <span class="id" title="var">false</span>.<br/>
<div class="togglescript" id="proofcontrol3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')"><span class="show"></span></div>
<div class="proofscript" id="proof3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')">
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
We allow public information to flow everywhere, and secret
    information to flow to secret variables: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">flows_public</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <span class="id" title="var">flows</span> <span class="id" title="var">public</span> <span class="id" title="var">l</span> = <span class="id" title="var">true</span>.<br/>
<div class="togglescript" id="proofcontrol4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')"><span class="show"></span></div>
<div class="proofscript" id="proof4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')">
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">flows_secret</span> : <span class="id" title="var">flows</span> <span class="id" title="var">secret</span> <span class="id" title="var">secret</span> = <span class="id" title="var">true</span>.<br/>
<div class="togglescript" id="proofcontrol5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')"><span class="show"></span></div>
<div class="proofscript" id="proof5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')">
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab728"></a><h2 class="section">Restrictive type system prohibiting branching on secrets</h2>

<div class="paragraph"> </div>

 We start with a simpler and more restrictive type system that
    prohibits branching on secrets. This is too strong a restriction
    for just noninterference, but as we will see later in this chapter
    it is needed for also preventing some side-channel attacks. 
<div class="paragraph"> </div>

 <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (SWT_Skip) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>s skip</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>a a &#x2208; l&nbsp;&nbsp;&nbsp;&nbsp;flows l (P X) = true</td>
  <td class="infrulenamecol" rowspan="3">
    (SWT_Asgn) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>s X := a</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>s c<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P <span class="nowrap">&vert;--</span>s c<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (SWT_Seq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>s c<sub>1</sub>;c<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>b b &#x2208; pubic&nbsp;&nbsp;&nbsp;&nbsp;P <span class="nowrap">&vert;--</span>s c<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P <span class="nowrap">&vert;--</span>s c<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (SWT_If) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>s if b then c<sub>1</sub> else c<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>b b &#x2208; pubic&nbsp;&nbsp;&nbsp;&nbsp;P <span class="nowrap">&vert;--</span>s c</td>
  <td class="infrulenamecol" rowspan="3">
    (SWT_While) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap">&vert;--</span>s while b then c end</td>
  <td></td>
</tr>
</table></center>
</div>

<div class="doc">
<a id="lab729"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 For now we show that <span class="inlinecode"><span class="id" title="var">strongly_well_typed</span></span> commands are
    noninterferent, but we will later show that it also enforces a
    security notion called program counter security, which prevents
    some side-channel attacks and which also serves as the base and
    cryptographic constant-time 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">strongly_well_typed_noninterferent</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">s</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Heq</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heval2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">y</span> <span class="id" title="var">Hy</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hxy</span> | <span class="id" title="var">Hxy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hxy</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">flows</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">orb_prop</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>8</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hl</span> | <span class="id" title="var">Hx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hl</span> <span class="id" title="keyword">in</span> ×. <span class="id" title="tactic">apply</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>7</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hy</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">t_update_neq</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hxy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_2</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_1</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>10</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>5</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>5</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>10</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>5</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>5</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>9</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>7</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>4</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>4</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_2</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_1</span>; <span class="id" title="var">eassumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
More permissive type system allowing branching on secrets 
<div class="paragraph"> </div>

 We now extend this to a more interesting IFC type system in which
    we do allow branching on secrets. 
</div>
<div class="code">

<span class="id" title="keyword">Reserved Notation</span> &quot;P ';;' pc '<span class="nowrap">&vert;--</span>' c" (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">well_typed</span> (<span class="id" title="var">P</span>:<span class="id" title="var">pub_vars</span>) : <span class="id" title="var">label</span> → <span class="id" title="var">com</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">WT_Com</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">pc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">pc</span> <span class="nowrap">&vert;--</span> &lt;{ <span class="id" title="var">skip</span> }&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">WT_Asgn</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">pc</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">a</span> <span class="id" title="var">a</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">flows</span> (<span class="id" title="var">join</span> <span class="id" title="var">pc</span> <span class="id" title="var">l</span>) (<span class="id" title="var">P</span> <span class="id" title="var">X</span>) = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">pc</span> <span class="nowrap">&vert;--</span> &lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">a</span> }&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">WT_Seq</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">pc</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">pc</span> <span class="nowrap">&vert;--</span> <span class="id" title="var">c<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">pc</span> <span class="nowrap">&vert;--</span> <span class="id" title="var">c<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">pc</span> <span class="nowrap">&vert;--</span> &lt;{ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> }&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">WT_If</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">pc</span> <span class="id" title="var">b</span> <span class="id" title="var">l</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">b</span> <span class="id" title="var">b</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; (<span class="id" title="var">join</span> <span class="id" title="var">pc</span> <span class="id" title="var">l</span>) <span class="nowrap">&vert;--</span> <span class="id" title="var">c<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; (<span class="id" title="var">join</span> <span class="id" title="var">pc</span> <span class="id" title="var">l</span>) <span class="nowrap">&vert;--</span> <span class="id" title="var">c<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">pc</span> <span class="nowrap">&vert;--</span> &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> }&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">WT_While</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">pc</span> <span class="id" title="var">b</span> <span class="id" title="var">l</span> <span class="id" title="var">c<sub>1</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">b</span> <span class="id" title="var">b</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; (<span class="id" title="var">join</span> <span class="id" title="var">pc</span> <span class="id" title="var">l</span>) <span class="nowrap">&vert;--</span> <span class="id" title="var">c<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">pc</span> <span class="nowrap">&vert;--</span> &lt;{ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">end</span> }&gt;<br/>
<br/>
<span class="id" title="keyword">where</span> &quot;P ';;' pc '<span class="nowrap">&vert;--</span>' c" := (<span class="id" title="var">well_typed</span> <span class="id" title="var">P</span> <span class="id" title="var">pc</span> <span class="id" title="var">c</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">weaken_pc</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">P</span> <span class="id" title="var">pc<sub>1</sub></span> <span class="id" title="var">pc<sub>2</sub></span> <span class="id" title="var">c</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">pc<sub>1</sub></span> <span class="nowrap">&vert;--</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">flows</span> <span class="id" title="var">pc<sub>2</sub></span> <span class="id" title="var">pc<sub>1</sub></span> = <span class="id" title="var">true</span>→<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">pc<sub>2</sub></span> <span class="nowrap">&vert;--</span> <span class="id" title="var">c</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">pc<sub>1</sub></span> <span class="id" title="var">pc<sub>2</sub></span> <span class="id" title="var">c</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">pc<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">pc<sub>2</sub></span> <span class="id" title="var">Hflows</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">flows_join_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">flows_join_1</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">flows_trans</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">flows_join_2</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">IHwell_typed1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">flows_join_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">flows_join_r<sub>1</sub></span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">flows_join_r<sub>2</sub></span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">flows_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">IHwell_typed2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">flows_join_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">flows_join_r<sub>1</sub></span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">flows_join_r<sub>2</sub></span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">flows_refl</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHwell_typed</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">flows_join_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">flows_join_r<sub>1</sub></span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">flows_join_r<sub>2</sub></span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">flows_refl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">secret_run</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">secret</span> <span class="nowrap">&vert;--</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">Heval</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_refl</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">y</span> <span class="id" title="var">Hy</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hxy</span> | <span class="id" title="var">Hxy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">join_secret_l</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>4</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hy</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>4</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>4</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_trans</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_refl</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_trans</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">different_code</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">secret</span> <span class="nowrap">&vert;--</span> <span class="id" title="var">c<sub>1</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">secret</span> <span class="nowrap">&vert;--</span> <span class="id" title="var">c<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>1</sub></span> =[ <span class="id" title="var">c<sub>1</sub></span> ]=&gt; <span class="id" title="var">s<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>2</sub></span> =[ <span class="id" title="var">c<sub>2</sub></span> ]=&gt; <span class="id" title="var">s<sub>2</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Hwt1</span> <span class="id" title="var">Hwt2</span> <span class="id" title="var">Hequiv</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">secret_run</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hwt1</span>; [| <span class="id" title="var">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">secret_run</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hwt2</span>; [| <span class="id" title="var">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_sym</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hwt1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_trans</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_trans</span>; <span class="id" title="var">eassumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">well_typed_noninterferent</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">public</span> <span class="nowrap">&vert;--</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Heq</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heval2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">y</span> <span class="id" title="var">Hy</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hxy</span> | <span class="id" title="var">Hxy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hxy</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">flows</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>9</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">join_public_l</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>9</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">orb_prop</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>9</sub></span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>9</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hl</span> | <span class="id" title="var">Hx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hl</span> <span class="id" title="keyword">in</span> ×. <span class="id" title="tactic">apply</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>8</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hy</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">t_update_neq</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hxy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_2</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_1</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;if&nbsp;true-true&nbsp;*)</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">join_public_l</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">weaken_pc</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">flows_public</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;if&nbsp;true-false&nbsp;*)</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">join_public_l</span> <span class="id" title="keyword">in</span> ×. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>11</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>5</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>5</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">different_code</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">c<sub>1</sub></span>:=<span class="id" title="var">c<sub>1</sub></span>) (<span class="id" title="var">c<sub>2</sub></span>:=<span class="id" title="var">c<sub>2</sub></span>); <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;if&nbsp;false-true&nbsp;*)</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">join_public_l</span> <span class="id" title="keyword">in</span> ×. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>11</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>5</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>5</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">different_code</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">c<sub>1</sub></span>:=<span class="id" title="var">c<sub>2</sub></span>) (<span class="id" title="var">c<sub>2</sub></span>:=<span class="id" title="var">c<sub>1</sub></span>); <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;if&nbsp;false-false&nbsp;*)</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">join_public_l</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">weaken_pc</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">flows_public</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;while&nbsp;false-false&nbsp;*)</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;while&nbsp;false-true&nbsp;*)</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">join_public_l</span> <span class="id" title="keyword">in</span> ×. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>10</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">different_code</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">c<sub>1</sub></span>:=&lt;{<span class="id" title="var">skip</span>}&gt;) (<span class="id" title="var">c<sub>2</sub></span>:=&lt;{<span class="id" title="var">c</span>;<span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span>}&gt;);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">econstructor</span>).<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;while&nbsp;true-false&nbsp;*)</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">join_public_l</span> <span class="id" title="keyword">in</span> ×. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>8</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>4</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>4</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">different_code</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">c<sub>1</sub></span>:=&lt;{<span class="id" title="var">c</span>;<span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span>}&gt;) (<span class="id" title="var">c<sub>2</sub></span>:=&lt;{<span class="id" title="var">skip</span>}&gt;);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">econstructor</span>).<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;while&nbsp;true-true&nbsp;*)</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">join_public_l</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_2</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">weaken_pc</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">flows_public</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab730"></a><h2 class="section">Type system for termination-sensitive noninterference</h2>

<div class="paragraph"> </div>

 The noninterference notion we used above was "termination
    insensitive". If we prevent loop conditions depending on secrets
    we can actually enforce termination-sensitive noninterference
    (TSNI), which we defined in Noninterference.v as follows: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">tsni</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>1</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">∃</span> <span class="id" title="var">s<sub>2</sub>'</span>, <span class="id" title="var">s<sub>2</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>2</sub>'</span> ∧ <span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span>).<br/>
</div>

<div class="doc">
We could prove that <span class="inlinecode"><span class="id" title="var">strongly_well_typed</span></span> enforces TSNI, but that
    typing relation is too restrictive, since for TSNI we can allow
    if-then-else conditions to depend on secrets. So we define a new
    type system that only prevents loop conditions to depend on secrets.
    Moreover, once branching on secrets with if-then-else
    (i.e. pc=secret) no while loops are allowed. 
</div>
<div class="code">

<span class="id" title="keyword">Reserved Notation</span> &quot;P ';;' pc '<span class="nowrap">&vert;--</span>ts' c" (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">ts_well_typed</span> (<span class="id" title="var">P</span>:<span class="id" title="var">pub_vars</span>) : <span class="id" title="var">label</span> → <span class="id" title="var">com</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">TS_Com</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">pc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">pc</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ts</span> &lt;{ <span class="id" title="var">skip</span> }&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">TS_Asgn</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">pc</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">a</span> <span class="id" title="var">a</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">flows</span> (<span class="id" title="var">join</span> <span class="id" title="var">pc</span> <span class="id" title="var">l</span>) (<span class="id" title="var">P</span> <span class="id" title="var">X</span>) = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">pc</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ts</span> &lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">a</span> }&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">TS_Seq</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">pc</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">pc</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ts</span> <span class="id" title="var">c<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">pc</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ts</span> <span class="id" title="var">c<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">pc</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ts</span> &lt;{ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> }&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">TS_If</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">pc</span> <span class="id" title="var">b</span> <span class="id" title="var">l</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">b</span> <span class="id" title="var">b</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; (<span class="id" title="var">join</span> <span class="id" title="var">pc</span> <span class="id" title="var">l</span>) <span class="nowrap">&vert;--</span><span class="id" title="var">ts</span> <span class="id" title="var">c<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; (<span class="id" title="var">join</span> <span class="id" title="var">pc</span> <span class="id" title="var">l</span>) <span class="nowrap">&vert;--</span><span class="id" title="var">ts</span> <span class="id" title="var">c<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">pc</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ts</span> &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> }&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">TS_While</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">b</span> <span class="id" title="var">c<sub>1</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">b</span> <span class="id" title="var">b</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">public</span> → <span class="comment">(*&nbsp;&lt;--&nbsp;NEW&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">public</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ts</span> <span class="id" title="var">c<sub>1</sub></span> → <span class="comment">(*&nbsp;&lt;--&nbsp;ONLY&nbsp;pc=public&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">public</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ts</span> &lt;{ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">end</span> }&gt;<br/>
<br/>
<span class="id" title="keyword">where</span> &quot;P ';;' pc '<span class="nowrap">&vert;--</span>ts' c" := (<span class="id" title="var">ts_well_typed</span> <span class="id" title="var">P</span> <span class="id" title="var">pc</span> <span class="id" title="var">c</span>).<br/>
</div>

<div class="doc">
We now prove that <span class="inlinecode"><span class="id" title="var">ts_well_typed</span></span> enforces TSNI.  
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">ts_well_typed_well_typed</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">pc</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">pc</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ts</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">pc</span> <span class="nowrap">&vert;--</span> <span class="id" title="var">c</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">pc</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">econstructor</span>; <span class="id" title="var">eassumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">ts_well_typed_noninterferent</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">public</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ts</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">well_typed_noninterferent</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ts_well_typed_well_typed</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ts_secret_run_terminating</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">secret</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ts</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">s'</span>, <span class="id" title="var">s</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s'</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">Hwt</span>. <span class="id" title="var">remember</span> <span class="id" title="var">secret</span> <span class="id" title="keyword">as</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">intro</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">IHHwt1</span> <span class="id" title="var">Heql</span> <span class="id" title="var">s</span>) <span class="id" title="keyword">as</span>  [<span class="id" title="var">s'</span> <span class="id" title="var">IH<sub>1</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">IHHwt2</span> <span class="id" title="var">Heql</span> <span class="id" title="var">s'</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">s''IH<sub>2</sub></span>]. <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">econstructor</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heql</span> <span class="id" title="keyword">in</span> ×. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">join_secret_l</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">IHHwt1</span> <span class="id" title="var">Logic.eq_refl</span> <span class="id" title="var">s</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">IH<sub>1</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">IHHwt2</span> <span class="id" title="var">Logic.eq_refl</span> <span class="id" title="var">s</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">IH<sub>2</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">s</span> <span class="id" title="var">b</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Heq</span>; <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">econstructor</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">discriminate</span> <span class="id" title="var">Heql</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">ts_well_typed_equitermination</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">public</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ts</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>1</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">s<sub>2</sub>'</span>, <span class="id" title="var">s<sub>2</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>2</sub>'</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">C</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">Heval</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">IHHeval1</span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">_</span> <span class="id" title="var">Heq</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">IH<sub>1</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Heq'</span> : <span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st'</span> <span class="id" title="var">s<sub>2</sub>'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">eapply</span> <span class="id" title="var">ts_well_typed_noninterferent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span>]. <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">IHHeval2</span> <span class="id" title="var">H<sub>3</sub></span> <span class="id" title="var">_</span> <span class="id" title="var">Heq'</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>2</sub>''</span> <span class="id" title="var">IH<sub>2</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">econstructor</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">join_public_l</span> <span class="id" title="keyword">in</span> ×. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> (<span class="id" title="var">IHHeval</span> <span class="id" title="var">H<sub>5</sub></span> <span class="id" title="var">_</span> <span class="id" title="var">Heq</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">IH<sub>1</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">E_IfTrue</span>; [ | <span class="id" title="var">eassumption</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_bexp</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heq</span>; [ | <span class="id" title="var">eassumption</span> ]. <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">ts_secret_run_terminating</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>5</sub></span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>5</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">H<sub>5</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">ts_secret_run_terminating</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>6</sub></span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>6</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">H<sub>6</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">b</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Heq2</span>; <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">econstructor</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">join_public_l</span> <span class="id" title="keyword">in</span> ×. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> (<span class="id" title="var">IHHeval</span> <span class="id" title="var">H<sub>6</sub></span> <span class="id" title="var">_</span> <span class="id" title="var">Heq</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">IH<sub>1</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">E_IfFalse</span>; [ | <span class="id" title="var">eassumption</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_bexp</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heq</span>; [ | <span class="id" title="var">eassumption</span> ]. <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">ts_secret_run_terminating</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>5</sub></span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>5</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">H<sub>5</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">ts_secret_run_terminating</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>6</sub></span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>6</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">H<sub>6</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">b</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Heq2</span>; <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">econstructor</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_bexp</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heq</span>; [ | <span class="id" title="var">eassumption</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">E_WhileFalse</span>. <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">IHHeval1</span> <span class="id" title="var">H<sub>3</sub></span> <span class="id" title="var">_</span> <span class="id" title="var">Heq</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">IH<sub>1</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Heq'</span> : <span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st'</span> <span class="id" title="var">s<sub>2</sub>'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">eapply</span> <span class="id" title="var">ts_well_typed_noninterferent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span>]. <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">IHHeval2</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">_</span> <span class="id" title="var">Heq'</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>2</sub>''</span> <span class="id" title="var">IH<sub>2</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_bexp</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heq</span>; [ | <span class="id" title="var">eassumption</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">E_WhileTrue</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>; <span class="id" title="var">eassumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">ts_well_typed_tsni</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">public</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ts</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">tsni</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">ts_well_typed_equitermination</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heq</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heval2</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">s<sub>2</sub>'</span>. <span class="id" title="tactic">split</span>; [<span class="id" title="tactic">assumption</span>| ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">ts_well_typed_noninterferent</span>; <span class="id" title="var">eassumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab731"></a><h2 class="section">Program counter security</h2>

<div class="paragraph"> </div>

 For cryptographic code one is also worried about side-channel
    attacks, in which secrets are for instance leaked via the
    execution time of the program. For instance, modern processors
    have instruction caches, which make executing cached instructions
    faster than non-cached ones. To prevent such attacks cryptographic
    code is normally written without branching on any. To formalize
    this we introduce a new security notion called program counter
    security, which considers the program's branching visible to the
    attacker. More precisely, we instrument the operational semantics
    of <span class="inlinecode"><span class="id" title="var">Imp</span></span> to also record the control-flow decisions of the program. 
</div>
<div class="code">

<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">List</span>. <span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">branches</span> := <span class="id" title="var">list</span> <span class="id" title="var">bool</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Reserved Notation</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"st '=[' c ']=&gt;' st' , bs"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40, <span class="id" title="var">c</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">st'</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="var">next</span> <span class="id" title="keyword">level</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">pceval</span> : <span class="id" title="var">com</span> → <span class="id" title="var">state</span> → <span class="id" title="var">state</span> → <span class="id" title="var">branches</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">E_Skip</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">skip</span> ]=&gt; <span class="id" title="var">st</span>, []<br/>
&nbsp;&nbsp;| <span class="id" title="var">E_Asgn</span>  : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">a</span> <span class="id" title="var">n</span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">a</span> = <span class="id" title="var">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">x</span> := <span class="id" title="var">a</span> ]=&gt; (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span> ; <span class="id" title="var">st</span>), []<br/>
&nbsp;&nbsp;| <span class="id" title="var">E_Seq</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">st</span> <span class="id" title="var">st'</span> <span class="id" title="var">st''</span> <span class="id" title="var">bs<sub>1</sub></span> <span class="id" title="var">bs<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span>  =[ <span class="id" title="var">c<sub>1</sub></span> ]=&gt; <span class="id" title="var">st'</span>, <span class="id" title="var">bs<sub>1</sub></span>  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st'</span> =[ <span class="id" title="var">c<sub>2</sub></span> ]=&gt; <span class="id" title="var">st''</span>, <span class="id" title="var">bs<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span>  =[ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> ]=&gt; <span class="id" title="var">st''</span>, (<span class="id" title="var">bs<sub>1</sub></span>++<span class="id" title="var">bs<sub>2</sub></span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">E_IfTrue</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">st'</span> <span class="id" title="var">b</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">bs<sub>1</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">b</span> = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c<sub>1</sub></span> ]=&gt; <span class="id" title="var">st'</span>, <span class="id" title="var">bs<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span>]=&gt; <span class="id" title="var">st'</span>, (<span class="id" title="var">true</span>::<span class="id" title="var">bs<sub>1</sub></span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">E_IfFalse</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">st'</span> <span class="id" title="var">b</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">bs<sub>1</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">b</span> = <span class="id" title="var">false</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c<sub>2</sub></span> ]=&gt; <span class="id" title="var">st'</span>, <span class="id" title="var">bs<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span>]=&gt; <span class="id" title="var">st'</span>, (<span class="id" title="var">false</span>::<span class="id" title="var">bs<sub>1</sub></span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">E_WhileFalse</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">b</span> <span class="id" title="var">st</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">b</span> = <span class="id" title="var">false</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> ]=&gt; <span class="id" title="var">st</span>, [<span class="id" title="var">false</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">E_WhileTrue</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">st'</span> <span class="id" title="var">st''</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> <span class="id" title="var">bs'</span> <span class="id" title="var">bs''</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">b</span> = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span>  =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st'</span>, <span class="id" title="var">bs'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st'</span> =[ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> ]=&gt; <span class="id" title="var">st''</span>, <span class="id" title="var">bs''</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span>  =[ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> ]=&gt; <span class="id" title="var">st''</span>, (<span class="id" title="var">bs'</span>++<span class="id" title="var">bs''</span>)<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">where</span> &quot;st =[ c ]=&gt; st' , bs" := (<span class="id" title="var">pceval</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">st'</span> <span class="id" title="var">bs</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">pceval_ceval</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">st'</span> <span class="id" title="var">bs</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st'</span>, <span class="id" title="var">bs</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st'</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">st'</span> <span class="id" title="var">bs</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">econstructor</span>; <span class="id" title="var">eassumption</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Using this instrumented semantics we define program counter security 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">pc_secure</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> := <span class="id" title="keyword">∀</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">bs<sub>1</sub></span> <span class="id" title="var">bs<sub>2</sub></span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>1</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>1</sub>'</span>, <span class="id" title="var">bs<sub>1</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>2</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>2</sub>'</span>, <span class="id" title="var">bs<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">bs<sub>1</sub></span> = <span class="id" title="var">bs<sub>2</sub></span>.<br/>
</div>

<div class="doc">
Program counter security is orthogonal to noninterference and
    instead of relating the final states it requires the branches of
    the program to be independent of secrets. Our restrictive
    <span class="inlinecode"><span class="id" title="var">strongly_well_typed</span></span> relation enforces both noninterference (as
    we already proved above) and program counter security: 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">strongly_well_typed_pc_secure</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">s</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pc_secure</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">bs<sub>1</sub></span> <span class="id" title="var">bs<sub>2</sub></span> <span class="id" title="var">Heq</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">bs<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">bs<sub>2</sub>'</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Heq</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heval2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_2</span>; [<span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_1</span> | | |];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;the&nbsp;proof&nbsp;does&nbsp;rely&nbsp;on&nbsp;noninterference&nbsp;for&nbsp;the&nbsp;sequencing&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">strongly_well_typed_noninterferent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="id" title="var">eassumption</span> | <span class="id" title="tactic">eapply</span> <span class="id" title="var">pceval_ceval</span>; <span class="id" title="var">eassumption</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="tactic">eapply</span> <span class="id" title="var">pceval_ceval</span>; <span class="id" title="var">eassumption</span> ]; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>11</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>6</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>6</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>11</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>6</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>6</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>10</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>8</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>5</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>5</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_2</span>; [<span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_1</span> | | |];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">strongly_well_typed_noninterferent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="id" title="var">eassumption</span> | <span class="id" title="tactic">eapply</span> <span class="id" title="var">pceval_ceval</span>; <span class="id" title="var">eassumption</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="tactic">eapply</span> <span class="id" title="var">pceval_ceval</span>; <span class="id" title="var">eassumption</span> ]; <span class="id" title="var">eassumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab732"></a><h2 class="section">Cryptographic constant-time</h2>

<div class="paragraph"> </div>

 Cryptographic constant-time (CCT) is a software countermeasure
    against cache-based timing attacks, a class of side-channel
    attacks that exploit the latency between cache hits and cache
    misses to retrieve cryptographic keys and other secrets. In
    addition to ensuring program counter security, CCT requires
    programmers to not perform memory accesses depending on
    secrets. To model this we first extend the Imp language with
    arrays, in which the accessed index is computed at runtime. 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">com'</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">Skip</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Asgn</span> (<span class="id" title="var">x</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">aexp</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Seq</span> (<span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">com'</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">If</span> (<span class="id" title="var">b</span> : <span class="id" title="var">bexp</span>) (<span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">com'</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">While</span> (<span class="id" title="var">b</span> : <span class="id" title="var">bexp</span>) (<span class="id" title="var">c</span> : <span class="id" title="var">com'</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">ARead</span> (<span class="id" title="var">x</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">aexp</span>) <span class="comment">(*&nbsp;&lt;---&nbsp;NEW&nbsp;*)</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">AWrite</span> (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">aexp</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">aexp</span>)  <span class="comment">(*&nbsp;&lt;---&nbsp;NEW&nbsp;*)</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="var">Declare</span> <span class="id" title="var">Custom</span> <span class="id" title="var">Entry</span> <span class="id" title="var">com'</span>.<br/>
<span class="id" title="keyword">Declare Scope</span> <span class="id" title="var">com'_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> &quot;&lt;<span style='letter-spacing:-.4em;'>{</span>{ e <span style='letter-spacing:-.4em;'>}</span>}&gt;" := <span class="id" title="var">e</span> (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">e</span> <span class="id" title="var">custom</span> <span class="id" title="var">com'</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99) : <span class="id" title="var">com'_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;( x )" := <span class="id" title="var">x</span> (<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com'</span>, <span class="id" title="var">x</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99) : <span class="id" title="var">com'_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;x" := <span class="id" title="var">x</span> (<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com'</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">x</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0) : <span class="id" title="var">com'_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;f x .. y" := (.. (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) .. <span class="id" title="var">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com'</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">only</span> <span class="id" title="var">parsing</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">f</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">x</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 9,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">y</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 9) : <span class="id" title="var">com'_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">com'_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> &quot;'skip'"  :=<br/>
&nbsp;&nbsp;<span class="id" title="var">Skip</span> (<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com'</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0) : <span class="id" title="var">com'_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;x := y"  :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">Asgn</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com'</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">x</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">y</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 85, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>) : <span class="id" title="var">com'_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;x ; y" :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">Seq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com'</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 90, <span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>) : <span class="id" title="var">com'_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;'if' x 'then' y 'else' z 'end'" :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">If</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com'</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 89, <span class="id" title="var">x</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">y</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99, <span class="id" title="var">z</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99) : <span class="id" title="var">com'_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;'while' x 'do' y 'end'" :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">While</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com'</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 89, <span class="id" title="var">x</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99, <span class="id" title="var">y</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99) : <span class="id" title="var">com'_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> &quot;x '&lt;-' a '[[' i ']]'"  :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">ARead</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com'</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">x</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 85, <span class="id" title="var">i</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 85, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>) : <span class="id" title="var">com'_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;a '[' i ']'  '&lt;-' e"  :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">AWrite</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span> <span class="id" title="var">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com'</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">a</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">e</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 85,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>) : <span class="id" title="var">com'_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">observation</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">OBranch</span> (<span class="id" title="var">b</span> : <span class="id" title="var">bool</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">OARead</span> (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">OAWrite</span> (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">obs</span> := <span class="id" title="var">list</span> <span class="id" title="var">observation</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Reserved Notation</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"'(' st , ast ')' '=[' c ']=&gt;' '(' stt , astt , os ')'"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40, <span class="id" title="var">c</span> <span class="id" title="var">custom</span> <span class="id" title="var">com'</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">ast</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">stt</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">astt</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="var">next</span> <span class="id" title="keyword">level</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">astate</span> := <span class="id" title="var">total_map</span> (<span class="id" title="var">list</span> <span class="id" title="var">nat</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">upd</span> (<span class="id" title="var">i</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">ns</span>:<span class="id" title="var">list</span> <span class="id" title="var">nat</span>) (<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>) : <span class="id" title="var">list</span> <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">i</span>, <span class="id" title="var">ns</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0, <span class="id" title="var">_</span> :: <span class="id" title="var">ns'</span> ⇒ <span class="id" title="var">n</span> :: <span class="id" title="var">ns'</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">i'</span>, <span class="id" title="var">_</span> :: <span class="id" title="var">ns'</span> ⇒ <span class="id" title="var">upd</span> <span class="id" title="var">i'</span> <span class="id" title="var">ns'</span> <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> ⇒ <span class="id" title="var">ns</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">cteval</span> : <span class="id" title="var">com'</span> → <span class="id" title="var">state</span> → <span class="id" title="var">astate</span> → <span class="id" title="var">state</span> → <span class="id" title="var">astate</span> → <span class="id" title="var">obs</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">CTE_Skip</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">st</span> , <span class="id" title="var">ast</span>) =[ <span class="id" title="var">skip</span> ]=&gt; (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, [])<br/>
&nbsp;&nbsp;| <span class="id" title="var">CTE_Asgn</span>  : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">e</span> <span class="id" title="var">n</span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">e</span> = <span class="id" title="var">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>) =[ <span class="id" title="var">x</span> := <span class="id" title="var">e</span> ]=&gt; (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, [])<br/>
&nbsp;&nbsp;| <span class="id" title="var">CTE_Seq</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">st''</span> <span class="id" title="var">ast''</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>) =[ <span class="id" title="var">c<sub>1</sub></span> ]=&gt; (<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">os<sub>1</sub></span>)  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>) =[ <span class="id" title="var">c<sub>2</sub></span> ]=&gt; (<span class="id" title="var">st''</span>, <span class="id" title="var">ast''</span>, <span class="id" title="var">os<sub>2</sub></span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>)  =[ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> ]=&gt; (<span class="id" title="var">st''</span>, <span class="id" title="var">ast''</span>, <span class="id" title="var">os<sub>1</sub></span>++<span class="id" title="var">os<sub>2</sub></span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">CTE_IfTrue</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">os<sub>1</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">b</span> = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>) =[ <span class="id" title="var">c<sub>1</sub></span> ]=&gt; (<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">os<sub>1</sub></span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>) =[ <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span>]=&gt; (<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">OBranch</span> <span class="id" title="var">true</span>::<span class="id" title="var">os<sub>1</sub></span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">CTE_IfFalse</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">os<sub>1</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">b</span> = <span class="id" title="var">false</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>) =[ <span class="id" title="var">c<sub>2</sub></span> ]=&gt; (<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">os<sub>1</sub></span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>) =[ <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span>]=&gt; (<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>::<span class="id" title="var">os<sub>1</sub></span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">CTE_WhileFalse</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">b</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">b</span> = <span class="id" title="var">false</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">st</span>,<span class="id" title="var">ast</span>) =[ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> ]=&gt; (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, [<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>])<br/>
&nbsp;&nbsp;| <span class="id" title="var">CTE_WhileTrue</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">st'</span> <span class="id" title="var">st''</span> <span class="id" title="var">ast</span> <span class="id" title="var">ast'</span> <span class="id" title="var">ast''</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> <span class="id" title="var">os'</span> <span class="id" title="var">os''</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">b</span> = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>)  =[ <span class="id" title="var">c</span> ]=&gt; (<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">os'</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>) =[ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> ]=&gt; (<span class="id" title="var">st''</span>, <span class="id" title="var">ast''</span>, <span class="id" title="var">os''</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>)  =[ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> ]=&gt; (<span class="id" title="var">st''</span>, <span class="id" title="var">ast''</span>, <span class="id" title="var">os'</span>++<span class="id" title="var">os''</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">CTE_ARead</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> = <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> &lt; <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>) =[ <span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">ie</span>]] ]=&gt; (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">nth</span> <span class="id" title="var">i</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) 0; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, [<span class="id" title="var">OARead</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>])<br/>
&nbsp;&nbsp;| <span class="id" title="var">CTE_Write</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">i</span> <span class="id" title="var">e</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">e</span> = <span class="id" title="var">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> = <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> &lt; <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>) =[ <span class="id" title="var">a</span>[<span class="id" title="var">ie</span>] &lt;- <span class="id" title="var">e</span> ]=&gt; (<span class="id" title="var">st</span>, <span class="id" title="var">a</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">upd</span> <span class="id" title="var">i</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) <span class="id" title="var">n</span>; <span class="id" title="var">ast</span>, [<span class="id" title="var">OAWrite</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>])<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">where</span> &quot;( st , ast ) =[ c ]=&gt; ( stt , astt , os )" := (<span class="id" title="var">cteval</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">stt</span> <span class="id" title="var">astt</span> <span class="id" title="var">os</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Reserved Notation</span> &quot;P ';;' PA '<span class="nowrap">&vert;--</span>ct' c" (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">pub_arrs</span> := <span class="id" title="var">total_map</span> <span class="id" title="var">label</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">ct_well_typed</span> (<span class="id" title="var">P</span>:<span class="id" title="var">pub_vars</span>) (<span class="id" title="var">PA</span>:<span class="id" title="var">pub_arrs</span>) : <span class="id" title="var">com'</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">CT_Com</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ct</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">skip</span> <span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">CT_Asgn</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">a</span> <span class="id" title="var">a</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">flows</span> <span class="id" title="var">l</span> (<span class="id" title="var">P</span> <span class="id" title="var">X</span>) = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ct</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> := <span class="id" title="var">a</span> <span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">CT_Seq</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ct</span> <span class="id" title="var">c<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ct</span> <span class="id" title="var">c<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ct</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> <span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">CT_If</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">b</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">b</span> <span class="id" title="var">b</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">public</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ct</span> <span class="id" title="var">c<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ct</span> <span class="id" title="var">c<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ct</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> <span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">CT_While</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">b</span> <span class="id" title="var">c<sub>1</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">b</span> <span class="id" title="var">b</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">public</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ct</span> <span class="id" title="var">c<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ct</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">end</span> <span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">CT_ARead</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">a</span> <span class="id" title="var">i</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">public</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">flows</span> (<span class="id" title="var">PA</span> <span class="id" title="var">a</span>) (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ct</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">i</span>]] <span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">CT_AWrite</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span> <span class="id" title="var">e</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">a</span> <span class="id" title="var">i</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">public</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap">&vert;--</span><span class="id" title="var">a</span> <span class="id" title="var">e</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">flows</span> <span class="id" title="var">l</span> (<span class="id" title="var">PA</span> <span class="id" title="var">a</span>) = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ct</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">a</span>[<span class="id" title="var">i</span>] &lt;- <span class="id" title="var">e</span> <span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
<br/>
<span class="id" title="keyword">where</span> &quot;P ;; PA '<span class="nowrap">&vert;--</span>ct' c" := (<span class="id" title="var">ct_well_typed</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">ct_well_typed_noninterferent</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">PA</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ct</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s<sub>1</sub></span>, <span class="id" title="var">a<sub>1</sub></span>) =[ <span class="id" title="var">c</span> ]=&gt; (<span class="id" title="var">s<sub>1</sub>'</span>, <span class="id" title="var">a<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s<sub>2</sub></span>, <span class="id" title="var">a<sub>2</sub></span>) =[ <span class="id" title="var">c</span> ]=&gt; (<span class="id" title="var">s<sub>2</sub>'</span>, <span class="id" title="var">a<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> ∧ <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span>.<br/>
<span class="id" title="var">Admitted</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">ct_well_typed_ct_secure</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">PA</span> <span class="nowrap">&vert;--</span><span class="id" title="var">ct</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s<sub>1</sub></span>, <span class="id" title="var">a<sub>1</sub></span>) =[ <span class="id" title="var">c</span> ]=&gt; (<span class="id" title="var">s<sub>1</sub>'</span>, <span class="id" title="var">a<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s<sub>2</sub></span>, <span class="id" title="var">a<sub>2</sub></span>) =[ <span class="id" title="var">c</span> ]=&gt; (<span class="id" title="var">s<sub>2</sub>'</span>, <span class="id" title="var">a<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">os<sub>1</sub></span> = <span class="id" title="var">os<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hwt</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Haeq</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">a<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">a<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">os<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">os<sub>2</sub>'</span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">Haeq</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Heq</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heval2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_2</span>; [<span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_1</span> | | | |];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">ct_well_typed_noninterferent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">ct_well_typed_noninterferent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>13</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>8</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>13</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>8</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>12</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>10</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>7</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>7</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_2</span>; [<span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_1</span> | | | |];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">ct_well_typed_noninterferent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">ct_well_typed_noninterferent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;NEW&nbsp;CASE:&nbsp;ARead&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;NEW&nbsp;CASE:&nbsp;AWrite&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="var">eassumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>